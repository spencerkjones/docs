"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7054],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),d=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return r.createElement(l.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=d(n),h=a,c=m["".concat(l,".").concat(h)]||m[h]||u[h]||i;return n?r.createElement(c,o(o({ref:t},p),{},{components:n})):r.createElement(c,o({ref:t},p))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:a,o[1]=s;for(var d=2;d<i;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3451:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var r=n(7462),a=(n(7294),n(3905));const i={},o="Checking and fixing file systems",s={unversionedId:"legacy/FAQ/check-disk-filesystems",id:"legacy/FAQ/check-disk-filesystems",title:"Checking and fixing file systems",description:"Is this the right page?",source:"@site/docs/legacy/FAQ/check-disk-filesystems.md",sourceDirName:"legacy/FAQ",slug:"/legacy/FAQ/check-disk-filesystems",permalink:"/legacy/FAQ/check-disk-filesystems",draft:!1,editUrl:"https://github.com/unraid/docs/tree/main/docs/legacy/FAQ/check-disk-filesystems.md",tags:[],version:"current",frontMatter:{},sidebar:"unraidSidebar",previous:{title:"Cache Disk",permalink:"/legacy/FAQ/cache-disk"},next:{title:"Check Harddrive Speed",permalink:"/legacy/FAQ/check-harddrive-speed"}},l={},d=[{value:"Is this the right page?",id:"is-this-the-right-page",level:3},{value:"Drive names and symbols",id:"drive-names-and-symbols",level:3},{value:"Which section?",id:"which-section",level:3},{value:"Checking and fixing drives in the webGui",id:"checking-and-fixing-drives-in-the-webgui",level:2},{value:"Preparing to test",id:"preparing-to-test",level:3},{value:"Running the test",id:"running-the-test",level:3},{value:"Running the repair",id:"running-the-repair",level:3},{value:"For ReiserFS drives",id:"for-reiserfs-drives",level:4},{value:"For XFS drives",id:"for-xfs-drives",level:4},{value:"For BTRFS drives and pools",id:"for-btrfs-drives-and-pools",level:4},{value:"Running the repair (continued)",id:"running-the-repair-continued",level:3},{value:"After the test and repair",id:"after-the-test-and-repair",level:3},{value:"Additional comments",id:"additional-comments",level:3},{value:"Drives formatted with XFS",id:"drives-formatted-with-xfs",level:2},{value:"Preparing to run xfs_repair",id:"preparing-to-run-xfs_repair",level:3},{value:"Running xfs_repair",id:"running-xfs_repair",level:3},{value:"After running xfs_repair",id:"after-running-xfs_repair",level:3},{value:"Additional comments",id:"additional-comments-1",level:3},{value:"Redoing a drive formatted with XFS",id:"redoing-a-drive-formatted-with-xfs",level:3},{value:"Drives formatted with BTRFS",id:"drives-formatted-with-btrfs",level:2},{value:"Experimental BTRFS recovery",id:"experimental-btrfs-recovery",level:3},{value:"Redoing a drive formatted with BTRFS",id:"redoing-a-drive-formatted-with-btrfs",level:3},{value:"Drives formatted with ReiserFS using Unraid v5 or later",id:"drives-formatted-with-reiserfs-using-unraid-v5-or-later",level:2},{value:"Preparing to run reiserfsck",id:"preparing-to-run-reiserfsck",level:3},{value:"Running reiserfsck",id:"running-reiserfsck",level:3},{value:"After running reiserfsck",id:"after-running-reiserfsck",level:3},{value:"Additional comments",id:"additional-comments-2",level:3},{value:"Drives formatted with ReiserFS using Unraid v4",id:"drives-formatted-with-reiserfs-using-unraid-v4",level:2},{value:"Preparing to run reiserfsck",id:"preparing-to-run-reiserfsck-1",level:3},{value:"Running reiserfsck",id:"running-reiserfsck-1",level:3},{value:"After running reiserfsck",id:"after-running-reiserfsck-1",level:3},{value:"Additional comments",id:"additional-comments-3",level:3},{value:"xfs_repair",id:"xfs_repair",level:2},{value:"Syntax",id:"syntax",level:5},{value:"Description",id:"description",level:5},{value:"Options",id:"options",level:5},{value:"Notes",id:"notes",level:5},{value:"Examples",id:"examples",level:5},{value:"btrfs scrub",id:"btrfs-scrub",level:2},{value:"Syntax",id:"syntax-1",level:5},{value:"Options",id:"options-1",level:5},{value:"Examples",id:"examples-1",level:5},{value:"reiserfsck",id:"reiserfsck",level:2},{value:"Description",id:"description-1",level:5},{value:"Syntax examples",id:"syntax-examples",level:5},{value:"Rebuilding the superblock",id:"rebuilding-the-superblock",level:5}],p={toc:d},m="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"checking-and-fixing-file-systems"},"Checking and fixing file systems"),(0,a.kt)("h3",{id:"is-this-the-right-page"},"Is this the right page?"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you suspect or have been told you may have file system\ncorruption, then you are on the right page! If you were told you\nhave drive errors, you are most likely not in the right place. If\nthe drive appears to be missing, then you are definitely not in the\nright place! This page is only for file system issues.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Your data is stored in files and folders, which are kept in a file\nsystem such as XFS, ReiserFS, or BTRFS. File systems are stored on\nphysical and other types of drives. ",(0,a.kt)("strong",{parentName:"p"},"The tools and instructions on\nthis page are ONLY for the maintenance and correction of file system\nissues, NOT for hardware or other drive issues.")," If you have any\nkind of hardware issues or drive errors (read errors, write errors,\nmissing, dropped, or red-balled drive), then this is NOT the right\npage! You need a syslog for the errors, and SMART reports for the\ndrives."),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If hardware or drive issues and running Unraid v6, please see\n",(0,a.kt)("a",{parentName:"li",href:"https://forums.unraid.net/forum/index.php?topic=39257"},"Need help? Read me\nfirst!"),"."),(0,a.kt)("li",{parentName:"ul"},"If hardware or drive issues  please see the\n",(0,a.kt)("a",{parentName:"li",href:"/unraid-os/manual/troubleshooting"},"Troubleshooting"),"\npage."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Very important!!! Do NOT run these tools\non the parity drive. It does NOT have a file system, and running ANY\nfile system repair tool on your parity drive will likely corrupt\nit!")," If you are here because of issues with your\nParity drive, PLEASE LEAVE NOW! You are in the wrong place! These\ntools and instructions are ONLY for data drives formatted with\nReiserFS, XFS, or BTRFS."))),(0,a.kt)("h3",{id:"drive-names-and-symbols"},"Drive names and symbols"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you will be using the v6 webGui, you don't have to worry about\nusing the right drive symbol, as it will be automatically and\ncorrectly selected for you.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"All others will be working at the command line, and the correct\ndrive symbol is vital! You call your drives by names such as ",(0,a.kt)("strong",{parentName:"p"},"Disk\n5"),", and use it in paths like ",(0,a.kt)("strong",{parentName:"p"},"/mnt/disk5"),". Linux has other names\nand symbols internally, for various and important purposes, and your\nsuccess here will depend on using the right one. When the kernel\nidentifies a drive and sets it up, it may assign SCSI symbols (e.g.\n",(0,a.kt)("strong",{parentName:"p"},"sd 2:0:1:0"),"), ATA symbols (e.g. ",(0,a.kt)("strong",{parentName:"p"},"ata7.00"),"), drive device\nsymbols (e.g. ",(0,a.kt)("strong",{parentName:"p"},"sdj"),", full path ",(0,a.kt)("strong",{parentName:"p"},"/dev/sdj"),"), and Unraid managed\ndrive device symbols (e.g. ",(0,a.kt)("strong",{parentName:"p"},"md5"),", full path ",(0,a.kt)("strong",{parentName:"p"},"/dev/md5"),"), all of\nwhich may refer to the same drive. The SCSI, ATA, and drive device\nsymbols will usually be different from each other, but the disk\nnumber, path name, and Unraid managed drive device name will be\ndirectly connected. ",(0,a.kt)("strong",{parentName:"p"},"Disk 7")," will always be ",(0,a.kt)("strong",{parentName:"p"},"/mnt/disk7")," and\nwill always be ",(0,a.kt)("strong",{parentName:"p"},"/dev/md7"),". However they are not interchangeable,\neach has to be used in the correct context. ",(0,a.kt)("strong",{parentName:"p"},"Disk 7")," is a\nhuman-readable label, ",(0,a.kt)("strong",{parentName:"p"},"/mnt/disk7")," is a folder, and ",(0,a.kt)("strong",{parentName:"p"},"/dev/md7"),"\nis an Unraid managed partition.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"To get a little more technical, we don't actually store data on\n",(0,a.kt)("strong",{parentName:"p"},"drives"),", we store it in file systems on ",(0,a.kt)("strong",{parentName:"p"},"partitions")," of those\ndrives. ",(0,a.kt)("strong",{parentName:"p"},"NEVER run a file system repair tool on the drive symbol,\nalways run it on the partition symbol.")," Which one is the partition\nsymbol? If ",(0,a.kt)("strong",{parentName:"p"},"Disk 3")," is a data disk associated with ",(0,a.kt)("strong",{parentName:"p"},"sdj"),", then\nthe drive symbol is ",(0,a.kt)("strong",{parentName:"p"},"/dev/sdj"),", and the 2 partition symbols are\n",(0,a.kt)("strong",{parentName:"p"},"/dev/sdj1")," (add a digit one for the first partition, two for the\nsecond, etc) and ",(0,a.kt)("strong",{parentName:"p"},"/dev/md3")," (for the Unraid managed drive\npartition). Both partition symbols refer to exactly the same\npartition, however I/O access to ",(0,a.kt)("strong",{parentName:"p"},"sdj1")," is direct, access to\n",(0,a.kt)("strong",{parentName:"p"},"md3")," goes through the Unraid parity management.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Why is this important for us to understand? Parity protection is\npreserved when the Unraid managed device symbols are used, NOT when\nthe Linux device symbols are used. If a drive is ",(0,a.kt)("strong",{parentName:"p"},"sdj")," and has a\nReiserFS formatted partition on it at ",(0,a.kt)("strong",{parentName:"p"},"sdj1")," and its array name is\n",(0,a.kt)("strong",{parentName:"p"},"Disk 5"),", then there are 2 ways to check/repair its file system.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"reiserfsck --fix-fixable /dev/sdj1")," ",(0,a.kt)("em",{parentName:"p"},"will fix the file system of\nthe first partition of the drive, but parity won't be updated, parity\nwill become invalid"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"reiserfsck --fix-fixable /dev/md5")," ",(0,a.kt)("em",{parentName:"p"},"will do exactly the same\nthing as the command above, EXCEPT the parity protection will be\nmaintained, parity will stay valid"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Note: NEVER run the first command on ",(0,a.kt)("strong",{parentName:"p"},"/dev/sdj"),", as it will\nlikely corrupt it. ALWAYS run it on the partition, either\n",(0,a.kt)("strong",{parentName:"p"},"/dev/sdj1")," or ",(0,a.kt)("strong",{parentName:"p"},"/dev/md5"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"These file system repair tools can be run against any partition with\nthe appropriate file system, not just Unraid data drives. So if the\ndrive you want to check or repair is the Cache drive or any other\ndrive that is not part of the Unraid array, then parity is\nirrelevant, and you would run the repair tool on the normal\npartition device symbol, e.g ",(0,a.kt)("strong",{parentName:"p"},"/dev/sdj1"),". The examples in the\nsections below however will assume the drive is part of the array\nand you want to preserve parity protection. Adapt the instructions\nas needed for non-array drives."))),(0,a.kt)("h3",{id:"which-section"},"Which section?"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Because the instructions are different depending on how your drive\nis formatted AND which version of Unraid you are running, this page\nis divided into 5 sections. Please follow only the instructions in\nthe correct section for your drive.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you are running Unraid v6, you can use the webGui to check and\nfix the file system of any data drive. Unless you prefer to work at\nthe command line, go to ",(0,a.kt)("a",{parentName:"p",href:"#checking-and-fixing-drives-in-the-webgui"},"Checking and fixing drives in the\nwebGui"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you are running Unraid v4 or v5 or prefer working at the command\nline -"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"It is vitally important that you know\nthe file system format of your drive!",(0,a.kt)("strong",{parentName:"li"},"`\n"),"If you\nuse the wrong repair tool on your drive, you may severely damage\nit, even worse than it may now be!**"),(0,a.kt)("li",{parentName:"ul"},"If you are running any version of Unraid prior to v5.0-beta8d,\nthen go to ",(0,a.kt)("a",{parentName:"li",href:"#drives-formatted-with-reiserfs-using-unraid-v4"},"Drives formatted with ReiserFS using Unraid\nv4"),"."),(0,a.kt)("li",{parentName:"ul"},"If you are running any other v5 version of Unraid, then go to\n",(0,a.kt)("a",{parentName:"li",href:"#drives-formatted-with-reiserfs-using-unraid-v5-or-later"},"Drives formatted with ReiserFS using Unraid v5 or later"),"."),(0,a.kt)("li",{parentName:"ul"},"If you are running any v6 version of Unraid and the drive is\nformatted with ReiserFS, then go to ",(0,a.kt)("a",{parentName:"li",href:"#drives-formatted-with-reiserfs-using-unraid-v5-or-later"},"Drives formatted with\nReiserFS using Unraid v5 or\nlater"),"."),(0,a.kt)("li",{parentName:"ul"},"If the drive is formatted with XFS, then go to ",(0,a.kt)("a",{parentName:"li",href:"#drives-formatted-with-xfs"},"Drives formatted\nwith\nXFS"),"."),(0,a.kt)("li",{parentName:"ul"},"If the drive is formatted with BTRFS, then go to ",(0,a.kt)("a",{parentName:"li",href:"#drives-formatted-with-btrfs"},"Drives\nformatted with\nBTRFS"),".\n",(0,a.kt)("em",{parentName:"li"},"But sorry, that section is not really ready yet."))))),(0,a.kt)("h2",{id:"checking-and-fixing-drives-in-the-webgui"},"Checking and fixing drives in the webGui"),(0,a.kt)("p",null,"The instructions here are designed to check and fix the integrity of the\nfile system of a data drive, while maintaining its parity info."),(0,a.kt)("h3",{id:"preparing-to-test"},"Preparing to test"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The first step is to identify the file system of the drive you wish\nto test or repair. If you don't know for sure, then go to the Main\npage of the webGui, and click on the name of the drive (Disk 3,\nCache, etc). Look for ",(0,a.kt)("strong",{parentName:"li"},"File system type"),", and you will see the\nfile system format for your drive (should be ",(0,a.kt)("strong",{parentName:"li"},"xfs"),", ",(0,a.kt)("strong",{parentName:"li"},"reiserfs"),",\nor ",(0,a.kt)("strong",{parentName:"li"},"btrfs"),")."),(0,a.kt)("li",{parentName:"ul"},"If the file system is ",(0,a.kt)("strong",{parentName:"li"},"XFS")," or ",(0,a.kt)("strong",{parentName:"li"},"ReiserFS")," (but NOT ",(0,a.kt)("strong",{parentName:"li"},"BTRFS"),"),\nthen you must start the array in Maintenance mode, by clicking the\nMaintenance mode check box before clicking the Start button. This\nstarts the Unraid driver but does not mount any of the drives."),(0,a.kt)("li",{parentName:"ul"},"If the file system is ",(0,a.kt)("strong",{parentName:"li"},"BTRFS"),", then make sure the array is\nstarted, and NOT in Maintenance mode."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Important note! Drives formatted with ",(0,a.kt)("strong",{parentName:"em"},"XFS")," or ",(0,a.kt)("strong",{parentName:"em"},"ReiserFS")," must\nbe checked and repaired in Maintenance mode. Drives formatted with\n",(0,a.kt)("strong",{parentName:"em"},"BTRFS")," cannot be checked or repaired in Maintenance mode! They\nmust be checked and repaired with the array started in the regular\nmode.")),(0,a.kt)("li",{parentName:"ul"},"From the Main screen of the webGui, click the name of the disk that\nyou want to test or repair. For example, if the drive of concern is\nDisk 5, then click on ",(0,a.kt)("strong",{parentName:"li"},"Disk 5"),". If it's the Cache drive, then\nclick on ",(0,a.kt)("strong",{parentName:"li"},"Cache"),"."),(0,a.kt)("li",{parentName:"ul"},"You should see a page of options for that drive, beginning with\nvarious partition, file system format, and spin down settings. The\nsection following that is the one you want, titled ",(0,a.kt)("strong",{parentName:"li"},"Check\nFilesystem Status"),". There is a box with the 2 words ",(0,a.kt)("strong",{parentName:"li"},"Not\navailable")," in it. This is the command output box, where the\nprogress and results of the command will be displayed. Below that is\nthe ",(0,a.kt)("strong",{parentName:"li"},"Check")," button that starts the test or repair, followed by the\noptions box where you can type in options for the test/repair\ncommand. The options box may already have default options in it, for\na read-only check of the file system. For more help, click the\n",(0,a.kt)("strong",{parentName:"li"},"Help")," button in the upper right.")),(0,a.kt)("h3",{id:"running-the-test"},"Running the test"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The default for most file system formats (",(0,a.kt)("strong",{parentName:"li"},"XFS")," and ",(0,a.kt)("strong",{parentName:"li"},"ReiserFS"),")\nis a read-only check of the file system, with no changes made to the\ndrive.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If the file system is ",(0,a.kt)("strong",{parentName:"li"},"ReiserFS"),", then the options box will be\nblank initially, which implies the ",(0,a.kt)("strong",{parentName:"li"},"-","-check")," option. Always\nbegin a ReiserFS drive test session with the ",(0,a.kt)("strong",{parentName:"li"},"-","-check"),"\noption!"),(0,a.kt)("li",{parentName:"ul"},"If the file system is ",(0,a.kt)("strong",{parentName:"li"},"XFS"),", then the options box will contain\nthe ",(0,a.kt)("strong",{parentName:"li"},"-n")," option (it means check only, ",(0,a.kt)("strong",{parentName:"li"},"n"),"o modification\nyet). We recommend adding the ",(0,a.kt)("strong",{parentName:"li"},"-v"),' option (it means\n"',(0,a.kt)("strong",{parentName:"li"},"v"),'erbose" for greater message display), so add a ',(0,a.kt)("strong",{parentName:"li"},"v")," to\nthe ",(0,a.kt)("strong",{parentName:"li"},"-n"),", making it ",(0,a.kt)("strong",{parentName:"li"},"-nv"),"."),(0,a.kt)("li",{parentName:"ul"},"If the file system is ",(0,a.kt)("strong",{parentName:"li"},"BTRFS"),", then you want the ",(0,a.kt)("strong",{parentName:"li"},"scrub"),"\ncommand, not the ",(0,a.kt)("strong",{parentName:"li"},"Balance")," command. The options box should\nalready have the recommended options in it."))),(0,a.kt)("li",{parentName:"ul"},"Once the options are correct, click the ",(0,a.kt)("strong",{parentName:"li"},"Check")," button to start\nthe operation."),(0,a.kt)("li",{parentName:"ul"},"The progress and results will be displayed, and you will review\nthem, and decide what action to take next. It is necessary to\nrefresh the screen periodically, using the ",(0,a.kt)("strong",{parentName:"li"},"Refresh")," button\nunderneath it or your browser's refresh button or keystroke, until\nthe display indicates the test or repair is complete."),(0,a.kt)("li",{parentName:"ul"},"If the results display a successful test, with no corruptions found,\nthen you are done! Skip down to ",(0,a.kt)("strong",{parentName:"li"},"After the test and repair"),".")),(0,a.kt)("h3",{id:"running-the-repair"},"Running the repair"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If however issues were found, the display of results will indicate\nthe recommended action to take. Typically, that will involve\nrepeating the command with a specific option, clearly stated, which\nyou will type into the options box (including any hyphens, usually 2\nleading hyphens)."),(0,a.kt)("li",{parentName:"ul"},"Then (if not ",(0,a.kt)("strong",{parentName:"li"},"BTRFS"),") click the ",(0,a.kt)("strong",{parentName:"li"},"Check")," button again to run the\nrepair."),(0,a.kt)("li",{parentName:"ul"},"Progress and results will again be displayed, and it's possible\nthat you will have to run it again, with perhaps a different option.\nIf the repairs were successful, it's recommended to run the\nread-only check one more time, to verify all is well now.")),(0,a.kt)("h4",{id:"for-reiserfs-drives"},"For ReiserFS drives"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"For more info on the ",(0,a.kt)("strong",{parentName:"li"},"reiserfsck")," tool and its options, see\n",(0,a.kt)("a",{parentName:"li",href:"#reiserfsck"},"reiserfsck"),".\nThere is also more information and some warnings about\n",(0,a.kt)("strong",{parentName:"li"},"reiserfsck")," options in the ",(0,a.kt)("a",{parentName:"li",href:"#running-reiserfsck-1"},"Running\nreiserfsck"),"\nsection below."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Important!")," If you are instructed to rerun the repair with\nthe ",(0,a.kt)("strong",{parentName:"li"},"-","-rebuild-tree")," option, then ",(0,a.kt)("strong",{parentName:"li"},"PLEASE")," read the\nwarnings in the ",(0,a.kt)("a",{parentName:"li",href:"#running-reiserfsck-1"},"Running\nreiserfsck"),"\nsection below!"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Important!")," If you are instructed to rerun the repair with\nthe ",(0,a.kt)("strong",{parentName:"li"},"-","-rebuild-sb")," option, then ",(0,a.kt)("strong",{parentName:"li"},"you cannot continue here in\nthe webGui!")," You will have to follow the instructions in the\n",(0,a.kt)("a",{parentName:"li",href:"#drives-formatted-with-reiserfs-using-unraid-v5-or-later"},"Drives formatted with ReiserFS using Unraid v5 or\nlater"),"\nsection below.")),(0,a.kt)("h4",{id:"for-xfs-drives"},"For XFS drives"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"For more info on the ",(0,a.kt)("strong",{parentName:"li"},"xfs_repair")," tool and its options, see\n",(0,a.kt)("a",{parentName:"li",href:"#xfs_repair"},"xfs_repair"),". See\nalso the ",(0,a.kt)("a",{parentName:"li",href:"#drives-formatted-with-xfs"},"Drives formatted with\nXFS"),"\nsection below.")),(0,a.kt)("h4",{id:"for-btrfs-drives-and-pools"},"For BTRFS drives and pools"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Use the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command. Use your best judgement, we have\nlittle experience yet. Do read the ",(0,a.kt)("a",{parentName:"li",href:"#drives-formatted-with-btrfs"},"Drives formatted with\nBTRFS"),"\nsection below."),(0,a.kt)("li",{parentName:"ul"},"For more info on the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command and its options, see\n",(0,a.kt)("a",{parentName:"li",href:"#btrfs-scrub"},"btrfs scrub"),"."),(0,a.kt)("li",{parentName:"ul"},"Unfortunately, the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command can detect but not fix\nerrors on single drives. If errors are detected, you will want\nto go to the ",(0,a.kt)("a",{parentName:"li",href:"#redoing-a-drive-formatted-with-btrfs"},"Redoing a drive formatted with\nBTRFS"),"\nsection."),(0,a.kt)("li",{parentName:"ul"},"If it's a drive pool, the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command can fix certain but\nnot all errors. So far there is not a reliable BTRFS tool that\ncan fix ALL possible errors. If the result indicates that there\nare still uncorrectable errors, then you will have to copy off\nall data and reformat the drive or pool anew (see ",(0,a.kt)("a",{parentName:"li",href:"#redoing-a-drive-formatted-with-btrfs"},"Redoing a\ndrive formatted with\nBTRFS"),")."),(0,a.kt)("li",{parentName:"ul"},"Unraid is committed to staying up-to-date with BTRFS\ndevelopment, so once better tools are ready, they will be\navailable here too.")),(0,a.kt)("h3",{id:"running-the-repair-continued"},"Running the repair (continued)"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"During and at the conclusion of the command, a report will be\ndisplayed, in the command output box. If errors are detected, this\nreport may specify additional actions to take. For XFS and BTRFS, we\ndon't yet have much expertise to advise you. Use your best\njudgement. Most of us will probably do whatever it suggests we do.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If your file system has only minor issues, then running the first\noption suggested should be all that is necessary. If it finds more\nsignificant corruption, then it may create a ",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder\nand place in it the files, folders, and parts of files it can\nrecover. It will then be up to you to rename them and restore those\nfiles and folders to their correct locations. Many times, it will be\npossible to identify them by their contents and size.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Note: If the repair command performs write operations to repair the\nfile system, parity ",(0,a.kt)("strong",{parentName:"p"},"will")," be maintained."))),(0,a.kt)("h3",{id:"after-the-test-and-repair"},"After the test and repair"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If you are in Maintenance mode, you can resume normal operations by\nstopping the array, then restarting the array with the Maintenance\nmode check box unchecked.")),(0,a.kt)("h3",{id:"additional-comments"},"Additional comments"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"These test and repair tools may take a long time on a full file\nsystem (several minutes to a half hour, or more).")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If there was significant corruption, then it is possible that some\nfiles were not completely recovered. Check for a ",(0,a.kt)("strong",{parentName:"p"},"lost+found"),"\nfolder on this drive, which may contain fragments of the\nunrecoverable files. It is up to you to examine these and determine\nwhat files they are from, and act accordingly. Hopefully, you have\nanother copy of each file. When you are finished examining them and\nsaving what you can, then delete the fragments and remove the\n",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder. Dealing with this folder does not have to be\ndone immediately. This is similar to running ",(0,a.kt)("strong",{parentName:"p"},"chkdsk")," or\n",(0,a.kt)("strong",{parentName:"p"},"scandisk")," within Windows, and finding lost clusters, and dealing\nwith files named File0000.chk or similar. You may find one user's\n",(0,a.kt)("a",{parentName:"p",href:"https://forums.unraid.net/forum/index.php?topic=1483"},"story")," very\nhelpful, plus his later\n",(0,a.kt)("a",{parentName:"p",href:"https://forums.unraid.net/forum/index.php?topic=3367.msg29056#msg29056"},"tale"),"\nof the problems of sifting through the recovered files."))),(0,a.kt)("h2",{id:"drives-formatted-with-xfs"},"Drives formatted with XFS"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Note: for more info on the xfs_repair tool and its options, see\n",(0,a.kt)("a",{parentName:"em",href:"#xfs_repair"},"xfs_repair"),".")),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("strong",{parentName:"li"},"xfs_repair")," instructions here are designed to check and fix\nthe integrity of the XFS file system of a data drive, while\nmaintaining its parity info.")),(0,a.kt)("h3",{id:"preparing-to-run-xfs_repair"},"Preparing to run xfs_repair"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Start the array in Maintenance mode, by clicking the Maintenance\nmode check box before clicking the Start button. This starts the\nUnraid driver but does not mount any of the drives.")),(0,a.kt)("h3",{id:"running-xfs_repair"},"Running xfs_repair"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Now you are ready to run the XFS file system test. At the console or\nin a ",(0,a.kt)("a",{parentName:"li",href:"/legacy/FAQ/terminal-access"},"terminal session with SSH or\nTelnet"),", type this: (",(0,a.kt)("em",{parentName:"li"},"Note: the\nfollowing example refers to Disk 1, as ",(0,a.kt)("strong",{parentName:"em"},"/dev/md1"),". You will need\nto substitute the correct drive for your case. For example, if it is\nyour Disk 5 that you are testing, then substitute ",(0,a.kt)("strong",{parentName:"em"},"md5")," for\n",(0,a.kt)("strong",{parentName:"em"},"md1"),"."),")")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"xfs_repair -v /dev/md1\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"During and at the conclusion of the ",(0,a.kt)("strong",{parentName:"p"},"xfs_repair")," command, a report\nwill be output. If errors are detected, this report may specify an\nadditional action to take. We don't yet have much expertise to\nadvise you about this. Use your best judgement. Most of us will\nprobably do whatever it suggests we do.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If your file system has only minor issues, then running ",(0,a.kt)("strong",{parentName:"p"},"xfs_repair\n-v")," should be all that is necessary. If it finds more significant\ncorruption, then it may create a ",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder and place in\nit the files, folders, and parts of files it can recover. It will\nthen be up to you to rename them and restore those files and folders\nto their correct locations. Many times, it will be possible to\nidentify them by their contents and size.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Note: If ",(0,a.kt)("strong",{parentName:"p"},"xfs_repair")," performs write operations to repair the file\nsystem, parity ",(0,a.kt)("strong",{parentName:"p"},"will")," be maintained."))),(0,a.kt)("h3",{id:"after-running-xfs_repair"},"After running xfs_repair"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If you are in Maintenance mode, you can resume normal operations by\nstopping the array, then restarting the array with the Maintenance\nmode check box unchecked.")),(0,a.kt)("h3",{id:"additional-comments-1"},"Additional comments"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The ",(0,a.kt)("strong",{parentName:"p"},"xfs_repair")," tool may take a long time on a full file system\n(several minutes to a half hour, or more).")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If the ",(0,a.kt)("strong",{parentName:"p"},"xfs_repair")," command fails, and we're hearing numerous\nreports of this(!), then you will have no recourse but to redo the\ndrive. Use the instructions in the ",(0,a.kt)("a",{parentName:"p",href:"#redoing-a-drive-formatted-with-xfs"},"Redoing a drive formatted with\nXFS"),"\nsection below. ",(0,a.kt)("em",{parentName:"p"},"We're sorry, we hope there will be better XFS\nrepair tools some day!"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If there was significant corruption, then it is possible that some\nfiles were not completely recovered. Check for a ",(0,a.kt)("strong",{parentName:"p"},"lost+found"),"\nfolder on this drive, which may contain fragments of the\nunrecoverable files. It is up to you to examine these and determine\nwhat files they are from, and act accordingly. Hopefully, you have\nanother copy of each file. When you are finished examining them and\nsaving what you can, then delete the fragments and remove the\n",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder. Dealing with this folder does not have to be\ndone immediately. This is similar to running ",(0,a.kt)("strong",{parentName:"p"},"chkdsk")," or\n",(0,a.kt)("strong",{parentName:"p"},"scandisk")," within Windows, and finding lost clusters, and dealing\nwith files named File0000.chk or similar. You may find one user's\n",(0,a.kt)("a",{parentName:"p",href:"https://forums.unraid.net/forum/index.php?topic=1483"},"story")," very\nhelpful, plus his later\n",(0,a.kt)("a",{parentName:"p",href:"https://forums.unraid.net/forum/index.php?topic=3367.msg29056#msg29056"},"tale"),"\nof the problems of sifting through the recovered files.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},'If you get an error indicating something like trouble opening the\nfile system, it may indicate that you attempted to run the file\nsystem check on the wrong device name. For almost all repairs, you\nwould use /dev/md1, /dev/md2, /dev/md3, /dev/md4, etc. If operating\non the cache drive (which is not protected by parity), you would use\n/dev/sdX1 (note the trailing "1" indicating the first partition on\nthe cache drive).')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you want to test and repair a non-array drive, you would use the\ndrive's partition symbol (e.g. sdc1, sdj1, sdx1, etc), not the\narray device symbol (e.g. md1, md13, etc). So the device name would\nbe something like /dev/sdj1, /dev/sdx1, etc."))),(0,a.kt)("h3",{id:"redoing-a-drive-formatted-with-xfs"},"Redoing a drive formatted with XFS"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If you are here because the XFS repair tool has failed you(!), then\nthe best we can recommend is to save the data, reformat, and restore\nthe data (NOT a desirable course of action)!")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Do your best to copy off everything you can, to a safe place. If\nsomething important is absolutely needed and still inaccessible, try\n",(0,a.kt)("a",{parentName:"li",href:"http://www.quetek.com/prod02.htm"},"File Scavenger")," or a live CD of\n",(0,a.kt)("a",{parentName:"li",href:"http://www.cgsecurity.org/wiki/TestDisk"},"TestDisk"),"."),(0,a.kt)("li",{parentName:"ol"},"Change the file system format for the drive to ReiserFS (just to\nreset the formatting, it's temporary and fairly quick)"),(0,a.kt)("li",{parentName:"ol"},"Start the array and format the drive"),(0,a.kt)("li",{parentName:"ol"},"Stop the array"),(0,a.kt)("li",{parentName:"ol"},"Change the file system format for the drive to XFS again"),(0,a.kt)("li",{parentName:"ol"},"Start the array and format the drive again"),(0,a.kt)("li",{parentName:"ol"},"Copy back everything you saved")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"It's certainly not a welcome method, but it does produce a fresh\nand clean XFS format. (",(0,a.kt)("em",{parentName:"li"},"The write-up above has not been tested by\nthis author. If corrections are needed, please do them, or PM RobJ\nwith the corrections or suggestions."),")")),(0,a.kt)("h2",{id:"drives-formatted-with-btrfs"},"Drives formatted with BTRFS"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"We're sorry, but we don't have enough experience yet with the\n",(0,a.kt)("strong",{parentName:"li"},"scrub")," command. We recommend reading through this section, then\neither using the\n",(0,a.kt)("a",{parentName:"li",href:"#checking-and-fixing-drives-in-the-webgui"},"webGui"),"\nto possibly repair a drive formatted with ",(0,a.kt)("strong",{parentName:"li"},"BTRFS"),", or if you are\ncomfortable at the command line, checking out the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command\nand its options, see ",(0,a.kt)("a",{parentName:"li",href:"#btrfs-scrub"},"btrfs\nscrub")," below. But\nultimately, if errors are found, you may have to redo the drive."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Unfortunately"),", the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command can detect but not fix\nerrors on single drives. It can only fix errors on pooled drives. If\nthis is a single drive and errors are detected, you will want to go\nto the ",(0,a.kt)("a",{parentName:"li",href:"#redoing-a-drive-formatted-with-btrfs"},"Redoing a drive formatted with\nBTRFS"),"\nsection."),(0,a.kt)("li",{parentName:"ul"},"If it's a drive pool, the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command can fix certain but not\nall errors. So far there is not a reliable BTRFS tool that can fix\nALL possible errors. If the result indicates that there are still\nuncorrectable errors, then you will have to copy off all data and\nreformat the drive or pool anew (see ",(0,a.kt)("a",{parentName:"li",href:"#redoing-a-drive-formatted-with-btrfs"},"Redoing a drive formatted with\nBTRFS"),")."),(0,a.kt)("li",{parentName:"ul"},"Unraid is committed to staying up-to-date with BTRFS development, so\nonce better tools are ready, they will be available here too."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"-","-","- work in progress ","-","-","-"))),(0,a.kt)("h3",{id:"experimental-btrfs-recovery"},"Experimental BTRFS recovery"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you consider yourself an advanced user (or desperate!), here are\nsome advanced tools that ","*","may","*"," help (or may make things worse!)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"*Important Mounting Note"),": The repair tools for ReiserFS and\nXFS require the drives to be unmounted, so to use their repair\ntools, you start the array in Maintenance mode. The ",(0,a.kt)("strong",{parentName:"p"},"btrfs\nscrub")," command requires the drive to be ","*","already","*"," mounted, so\nyou first start the array in regular mode, NOT in Maintenance\nmode. The other BTRFS tools mentioned here may or may not\nrequire the drive to be mounted, so read their instructions\ncarefully. If the tool requires the drive to be unmounted, then\nstart the array in Maintenance mode. If the tool requires the\ndrive to be mounted, then start the array in regular mode.*")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The first tool you use should be the ",(0,a.kt)("strong",{parentName:"p"},"btrfs scrub")," command\nmentioned above, see ",(0,a.kt)("a",{parentName:"p",href:"#btrfs-scrub"},"btrfs scrub")," below.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"There is a BTRFS restore tool, that ","*","may","*"," be able to recover\nmore data from your drive. It works in a read-only mode so it is\nsafe to use. Please see the ",(0,a.kt)("a",{parentName:"p",href:"http://btrfs.wiki.kernel.org/index.php/Restore"},"btrfs\nrestore")," wiki\npage.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The very last resort tool is ",(0,a.kt)("strong",{parentName:"p"},"btrfs check ","-","-repair"),". It's\nreported to fix some issues some of the time, but with a good\nchance it will make others worse! You have been warned! Please\nsee the ",(0,a.kt)("a",{parentName:"p",href:"http://btrfs.wiki.kernel.org/index.php/Btrfsck"},"btrfs check\n","-","-repair")," wiki\npage.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"General recommendation - try ",(0,a.kt)("strong",{parentName:"p"},"btrfs scrub")," first. If it fails\nto completely fix everything, then redo the drive using the\nfollowing procedure, using ",(0,a.kt)("strong",{parentName:"p"},"btrfs restore")," if needed."))),(0,a.kt)("h3",{id:"redoing-a-drive-formatted-with-btrfs"},"Redoing a drive formatted with BTRFS"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("em",{parentName:"strong"},"Note: the following is for a single drive formatted in BTRFS, not\nfor a drive pool. For a pool, you will have to adapt it, until we\nadd adapted instructions. Sorry!"))),(0,a.kt)("li",{parentName:"ul"},"BTRFS repair tools aren't very good yet. If you give up on the\n",(0,a.kt)("strong",{parentName:"li"},"scrub")," command mentioned above, then the best we can recommend is\nto save the data, reformat, and restore the data (NOT a desirable\ncourse of action)!"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Note: if this is a single drive, we recommend either adding\nanother drive and making it a drive pool, or switching to XFS,\nbecause"),"btrfs scrub",(0,a.kt)("strong",{parentName:"li"},"cannot fix single drives."))),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Do your best to copy off everything you can, to a safe place. If\nsomething important is absolutely needed and still inaccessible, try\n",(0,a.kt)("a",{parentName:"li",href:"http://btrfs.wiki.kernel.org/index.php/Restore"},"btrfs restore")),(0,a.kt)("li",{parentName:"ol"},"Change the file system format for the drive to ReiserFS (just to\nreset the formatting, it's temporary and fairly quick)"),(0,a.kt)("li",{parentName:"ol"},"Start the array and format the drive"),(0,a.kt)("li",{parentName:"ol"},"Stop the array"),(0,a.kt)("li",{parentName:"ol"},"Change the file system format for the drive to BTRFS again (if it's\na single drive, consider changing to XFS, we recommend it)"),(0,a.kt)("li",{parentName:"ol"},"Start the array and format the drive again"),(0,a.kt)("li",{parentName:"ol"},"Copy back everything you saved")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"It's certainly not a welcome method, but it does produce a fresh\nand clean format. (",(0,a.kt)("em",{parentName:"li"},"The write-up above has not been tested by this\nauthor. If corrections are needed, please do them, or PM RobJ with\nthe corrections or suggestions."),")")),(0,a.kt)("h2",{id:"drives-formatted-with-reiserfs-using-unraid-v5-or-later"},"Drives formatted with ReiserFS using Unraid v5 or later"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Note: for more info on the ",(0,a.kt)("strong",{parentName:"em"},"reiserfsck")," tool and its options, see\n",(0,a.kt)("a",{parentName:"em",href:"#reiserfsck"},"reiserfsck"),"."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Note2: Unraid data disks formatted with ReiserFS use ",(0,a.kt)("a",{parentName:"em",href:"http://en.wikipedia.org/wiki/ReiserFS"},"ReiserFS\nversion 3.6"),"."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"This section is only for users who are running Unraid v5.0-beta8d or\nlater. If you are running an earlier version, including all Unraid\nv4, please go to the next section, ",(0,a.kt)("a",{parentName:"p",href:"#drives-formatted-with-reiserfs-using-unraid-v4"},"Drives formatted with ReiserFS\nusing Unraid\nv4"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," instructions here are designed to check and fix\nthe integrity of the Reiser file system of a data drive, while\nmaintaining its parity info.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Note: the following examples refer to Disk 1, as ",(0,a.kt)("strong",{parentName:"em"},"/dev/md1"),". You\nwill need to substitute the correct drive for each case. For\nexample, if it is your Disk 5 that you are testing, then substitute\n",(0,a.kt)("strong",{parentName:"em"},"md5")," for ",(0,a.kt)("strong",{parentName:"em"},"md1"),", in all of the instructions below.")))),(0,a.kt)("h3",{id:"preparing-to-run-reiserfsck"},"Preparing to run reiserfsck"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Start the array in Maintenance mode, by clicking the Maintenance\nmode check box before clicking the Start button. This starts the\nUnraid driver but does not mount any of the drives.")),(0,a.kt)("h3",{id:"running-reiserfsck"},"Running reiserfsck"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Now you are ready to run the Reiser file system test. (Note:\n","-","-check is the default option, not strictly required, but included\nhere for clarification.) At the console or in a ",(0,a.kt)("a",{parentName:"p",href:"/legacy/FAQ/terminal-access"},"terminal session\nwith SSH or Telnet"),", type this:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"reiserfsck --check /dev/md1 [answer with the word **Yes**\n when prompted, do not type **yes** or **YES**, but **Yes**\n (capital **Y** and lower case **es**)]*\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"At the conclusion of the ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck ","-","-check")," command, a report\nwill be output. If errors are detected, this report may specify an\nadditional action to take. The most common ones are to re-run\n",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," specifying the ",(0,a.kt)("strong",{parentName:"p"},"-","-fix-fixable")," switch or the\n",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-tree")," switch, for example:"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"    reiserfsck --fix-fixable /dev/md1 [answer with **Yes**\n     when prompted. (capital **Y** and lower case **es**)]\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If your file system has only minor issues, then running ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck\n","-","-fix-fixable")," should be all that is necessary.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Important Note!!!")," Do NOT run\n",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," with the ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-sb")," or ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-tree"),"\noptions, unless you are instructed to by the output of a previous\nrun of ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," or by an expert user! They are\nlast-resort options, to repair a severely damaged Reiser file\nsystem, and recover as much as possible. They rarely repair the\nsystem to perfection, and there may be a little data loss. They do a\ngreat job, and make the drive usable again, but it's possible files\nmay be lost or damaged, or moved into the ",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder. The\n",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-tree")," option will almost always create a\n",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder and place in it the files, folders, and parts\nof files it can recover. It will then be up to you to rename them\nand restore those files and folders to their correct locations. Many\ntimes, it will be possible to identify them by their contents and\nsize.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Important Note #2!!!")," If\nthe option ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-sb")," is suggested, then please see the\n",(0,a.kt)("a",{parentName:"p",href:"#rebuilding-the-superblock"},"Rebuilding the\nsuperblock"),"\nsection below, and follow its instructions ",(0,a.kt)("strong",{parentName:"p"},"VERY CAREFULLY"),".\nThe ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-sb")," option requires\nanswers that must be ",(0,a.kt)("strong",{parentName:"p"},"PERFECT"),"! If you are unsure\nabout anything, consider asking for assistance on the Unraid forums.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Note: If ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," performs write operations to repair the file\nsystem, parity ",(0,a.kt)("strong",{parentName:"p"},"will")," be maintained."))),(0,a.kt)("h3",{id:"after-running-reiserfsck"},"After running reiserfsck"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If you are in Maintenance mode, you can resume normal operations by\nstopping the array, then restarting the array with the Maintenance\nmode check box unchecked.")),(0,a.kt)("h3",{id:"additional-comments-2"},"Additional comments"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," tool may take a long time on a full file system\n(several minutes to a half hour, or more). Also re-mounting the disk\ncan take up to 15 seconds or so.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you were instructed to use special parameters such as\n",(0,a.kt)("strong",{parentName:"p"},"-","-fix-fixable")," and ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-tree"),", then it is possible that\nsome files were not completely recovered. Check for a ",(0,a.kt)("strong",{parentName:"p"},"lost+found"),"\nfolder on this drive, which may contain fragments of the\nunrecoverable files. It is unfortunately up to you to examine these\nand determine what files they are from, and act accordingly.\nHopefully, you have another copy of each file. When you are finished\nexamining them and saving what you can, then delete the fragments\nand remove the ",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder. Dealing with this folder does\nnot have to be done immediately. This is similar to running\n",(0,a.kt)("strong",{parentName:"p"},"chkdsk")," or ",(0,a.kt)("strong",{parentName:"p"},"scandisk")," within Windows, and finding lost\nclusters, and dealing with files named File0000.chk or similar. You\nmay find one user's\n",(0,a.kt)("a",{parentName:"p",href:"https://forums.unraid.net/forum/index.php?topic=1483"},"story")," very\nhelpful, plus his later\n",(0,a.kt)("a",{parentName:"p",href:"https://forums.unraid.net/forum/index.php?topic=3367.msg29056#msg29056"},"tale"),"\nof the problems of sifting through the recovered files.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you get an error that says ",(0,a.kt)("strong",{parentName:"p"},"reiserfs_open: the reiserfs\nsuperblock cannot be found on /dev/sdX. Failed to open the\nfilesystem."),' it usually indicates you attempted to run the file\nsystem check on the wrong device name. For almost all repairs, you\nwould use /dev/md1, /dev/md2, /dev/md3, /dev/md4, etc. If operating\non the cache drive (which is not protected by parity), you would use\n/dev/sdX1 (note the trailing "1" indicating the first partition on\nthe cache drive).')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you want to test and repair a non-array drive, you would use the\ndrive's partition symbol (e.g. sdc1, sdj1, sdx1, etc), not the\narray device symbol (e.g. md1, md13, etc). So the device name would\nbe something like /dev/sdj1, /dev/sdx1, etc."))),(0,a.kt)("h2",{id:"drives-formatted-with-reiserfs-using-unraid-v4"},"Drives formatted with ReiserFS using Unraid v4"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Note: for more info on the ",(0,a.kt)("strong",{parentName:"em"},"reiserfsck")," tool and its options, see\n",(0,a.kt)("a",{parentName:"em",href:"#reiserfsck"},"reiserfsck"),"."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Note2: Unraid data disks formatted with ReiserFS use ",(0,a.kt)("a",{parentName:"em",href:"http://en.wikipedia.org/wiki/ReiserFS"},"ReiserFS\nversion 3.6"),"."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"This section is only for users who are running any version of Unraid\nprior to v5.0-beta8d, including all Unraid v4 versions. If you are\nrunning a later version, please go to the previous section, ",(0,a.kt)("a",{parentName:"p",href:"#drives-formatted-with-reiserfs-using-unraid-v5-or-later"},"Drives\nformatted with ReiserFS using Unraid v5 or\nlater"),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," instructions here are designed to check and fix\nthe integrity of the Reiser file system of a data drive, while\nmaintaining its parity info.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Note: the following examples refer to Disk 1, as ",(0,a.kt)("strong",{parentName:"em"},"/dev/md1"),". You\nwill need to substitute the correct drive for each case. For\nexample, if it is your Disk 5 that you are testing, then substitute\n",(0,a.kt)("strong",{parentName:"em"},"md5")," for ",(0,a.kt)("strong",{parentName:"em"},"md1"),", and ",(0,a.kt)("strong",{parentName:"em"},"disk5")," for ",(0,a.kt)("strong",{parentName:"em"},"disk1"),", in all of the\ninstructions below.")))),(0,a.kt)("h3",{id:"preparing-to-run-reiserfsck-1"},"Preparing to run reiserfsck"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Start the array, then from the console or in a ",(0,a.kt)("a",{parentName:"li",href:"/legacy/FAQ/terminal-access"},"terminal session\nwith SSH or Telnet"),", type this:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"    cd [this will make sure you are in the /root directory]\n    samba stop [all your shares will disappear from network]\n    umount /dev/md1 ['md1' corresponds to disk1, 'md2' to disk2, etc. note: it is 'umount', not 'unmount']\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"*Note:"),' you will not be able to unmount the disk if it is\n"busy." A disk is busy if any processes are using it, or\nreferencing files/folders on it. If the "umount" command is not\nsuccessful, you will need to stop any add-on process you might have\nrunning that are referencing the disk before you can unmount it. If\nyou have "changed directory" to it, you must log off, or "cd"\nelsewhere (off the disk) before the "umount" will succeed.*')),(0,a.kt)("h3",{id:"running-reiserfsck-1"},"Running reiserfsck"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Now you are ready to run the Reiser file system test. (Note:\n","-","-check is the default option, not strictly required, but included\nhere for clarification.) At the console or in a ",(0,a.kt)("a",{parentName:"li",href:"/legacy/FAQ/terminal-access"},"terminal session\nwith SSH or Telnet"),", type this:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"    reiserfsck --check /dev/md1 \n      [answer with the word **Yes** when prompted, do not type **yes** or **YES**, \n      but **Yes** (capital **Y** and lower case **es**)]\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"At the conclusion of the ",(0,a.kt)("strong",{parentName:"li"},"reiserfsck ","-","-check")," command, a report\nwill be output. If errors are detected, this report may specify an\nadditional action to take. The most common ones are to re-run\n",(0,a.kt)("strong",{parentName:"li"},"reiserfsck")," specifying the ",(0,a.kt)("strong",{parentName:"li"},"-","-fix-fixable")," switch or the\n",(0,a.kt)("strong",{parentName:"li"},"-","-rebuild-tree")," switch, for example:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"   reiserfsck --fix-fixable /dev/md1\n     [answer with **Yes** when prompted. (capital **Y** and lower case **es**)]\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If your file system has only minor issues, then running ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck\n","-","-fix-fixable")," should be all that is necessary.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Important Note!!!")," Do NOT run\n",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," with the ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-sb")," or ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-tree"),"\noptions, unless you are instructed to by the output of a previous\nrun of ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," or by an expert user!\nThey are\nlast-resort options, to repair a severely damaged Reiser file\nsystem, and recover as much as possible. They rarely repair the\nsystem to perfection, and there may be a little data loss. They do a\ngreat job, and make the drive usable again, but it's possible files\nmay be lost or damaged, or moved into the ",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder. The\n",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-tree")," option will almost always create a\n",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder and place in it the files, folders, and parts\nof files it can recover. It will then be up to you to rename them\nand restore those files and folders to their correct locations. Many\ntimes, it will be possible to identify them by their contents and\nsize.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Important Note #2!!!")," If\nthe option ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-sb")," is suggested, then please see the\n",(0,a.kt)("a",{parentName:"p",href:"#rebuilding-the-superblock"},"Rebuilding the\nsuperblock"),"\nsection below, and follow its instructions ",(0,a.kt)("strong",{parentName:"p"},"VERY CAREFULLY"),".\nThe ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-sb")," option requires\nanswers that must be ",(0,a.kt)("strong",{parentName:"p"},"PERFECT"),"! If you are unsure\nabout anything, consider asking for assistance on the Unraid forums.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Note: If ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," performs write operations to repair the file\nsystem, parity ",(0,a.kt)("strong",{parentName:"p"},"will")," be maintained."))),(0,a.kt)("h3",{id:"after-running-reiserfsck-1"},"After running reiserfsck"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"You can resume normal operations by, from the console or in a\n",(0,a.kt)("a",{parentName:"li",href:"/legacy/FAQ/terminal-access"},"terminal session with SSH or Telnet"),",\ntyping this:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"   mount /dev/md1 /mnt/disk1 [important to match up the 'md1' with 'disk1', 'md2' with 'disk2', etc.]\n   samba start [all shares should again be visible]\n")),(0,a.kt)("h3",{id:"additional-comments-3"},"Additional comments"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"The ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," tool may take a long time on a full file system\n(several minutes to a half hour, or more). Also re-mounting the disk\ncan take up to 15 seconds or so.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you were instructed to use special parameters such as\n",(0,a.kt)("strong",{parentName:"p"},"-","-fix-fixable")," and ",(0,a.kt)("strong",{parentName:"p"},"-","-rebuild-tree"),", then it is possible that\nsome files were not completely recovered. Check for a ",(0,a.kt)("strong",{parentName:"p"},"lost+found"),"\nfolder on this drive, which may contain fragments of the\nunrecoverable files. It is unfortunately up to you to examine these\nand determine what files they are from, and act accordingly.\nHopefully, you have another copy of each file. When you are finished\nexamining them and saving what you can, then delete the fragments\nand remove the ",(0,a.kt)("strong",{parentName:"p"},"lost+found")," folder. Dealing with this folder does\nnot have to be done immediately. This is similar to running\n",(0,a.kt)("strong",{parentName:"p"},"chkdsk")," or ",(0,a.kt)("strong",{parentName:"p"},"scandisk")," within Windows, and finding lost\nclusters, and dealing with files named File0000.chk or similar. You\nmay find one user's\n",(0,a.kt)("a",{parentName:"p",href:"https://forums.unraid.net/forum/index.php?topic=1483"},"story")," very\nhelpful, plus his later\n",(0,a.kt)("a",{parentName:"p",href:"https://forums.unraid.net/forum/index.php?topic=3367.msg29056#msg29056"},"tale"),"\nof the problems of sifting through the recovered files.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you get an error that says ",(0,a.kt)("strong",{parentName:"p"},"reiserfs_open: the reiserfs\nsuperblock cannot be found on /dev/sdX. Failed to open the\nfilesystem."),' it usually indicates you attempted to run the file\nsystem check on the wrong device name. For almost all repairs, you\nwould use /dev/md1, /dev/md2, /dev/md3, /dev/md4, etc. If operating\non the cache drive (which is not protected by parity), you would use\n/dev/sdX1 (note the trailing "1" indicating the first partition on\nthe cache drive).')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If you want to test and repair a non-array drive, you would use the\ndrive's partition symbol (e.g. sdc1, sdj1, sdx1, etc), not the\narray device symbol (e.g. md1, md13, etc). So the device name would\nbe something like /dev/sdj1, /dev/sdx1, etc."))),(0,a.kt)("h1",{id:"tools"},"Tools"),(0,a.kt)("h2",{id:"xfs_repair"},"xfs_repair"),(0,a.kt)("h5",{id:"syntax"},"Syntax"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"The filesystem to be repaired must be unmounted"),", otherwise, the\nresulting filesystem may be inconsistent or corrupt. For Unraid,\nstart the array in Maintenance mode.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"xfs_repair [ -dnvLP ] device\nxfs_repair -V\n")),(0,a.kt)("p",null,"Source: derived from ",(0,a.kt)("a",{parentName:"p",href:"http://linux.die.net/man/8/xfs_repair"},"Linux man\npage")," (there are many more\noptions, but probably too dangerous for our use)"),(0,a.kt)("h5",{id:"description"},"Description"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"xfs_repair repairs corrupt or damaged XFS filesystems (see xfs(5)).\nThe filesystem is specified using the device argument which should\nbe the device name of the disk partition or volume containing the\nfilesystem. If given the name of a block device, xfs_repair will\nattempt to find the raw device associated with the specified block\ndevice and will use the raw device instead.")),(0,a.kt)("h5",{id:"options"},"Options"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"-n",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"No modify mode. Specifies that xfs_repair should not modify the\nfilesystem but should only scan the filesystem and indicate what\nrepairs would have been made."))),(0,a.kt)("li",{parentName:"ul"},"-v",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Verbose output."))),(0,a.kt)("li",{parentName:"ul"},"-V",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Prints out the current version number and exits."))),(0,a.kt)("li",{parentName:"ul"},"-d",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Repair dangerously. Allow xfs_repair to repair an XFS filesystem\nmounted read only. This is typically done on a root filesystem\nfrom single user mode, immediately followed by a reboot."))),(0,a.kt)("li",{parentName:"ul"},"-L",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Force Log Zeroing. Forces xfs_repair to zero the log even if it\nis dirty (contains metadata changes). When using this option the\nfilesystem will likely appear to be corrupt, and can cause the\nloss of user files and/or data."))),(0,a.kt)("li",{parentName:"ul"},"-P",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Disable prefetching of inode and directory blocks. Use this\noption if you find xfs_repair gets stuck and stops proceeding.\nInterrupting a stuck xfs_repair is safe.")))),(0,a.kt)("h5",{id:"notes"},"Notes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Disk Errors"),": xfs_repair aborts on most disk I/O errors.\nTherefore, if you are trying to repair a filesystem that was damaged\ndue to a disk drive failure, steps should be taken to ensure that\nall blocks in the filesystem are readable and writeable before\nattempting to use xfs_repair to repair the filesystem. A possible\nmethod is using dd(8) to copy the data onto a good disk.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"lost+found"),": The directory lost+found does not have to already\nexist in the filesystem being repaired. If the directory does not\nexist, it is automatically created if required. If it already\nexists, it will be checked for consistency and if valid will be used\nfor additional orphaned files. Invalid lost+found directories are\nremoved and recreated. Existing files in a valid lost+found are not\nremoved or renamed.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Corrupted Superblocks"),": XFS has both primary and secondary\nsuperblocks. xfs_repair uses information in the primary superblock\nto automatically find and validate the primary superblock against\nthe secondary superblocks before proceeding. Should the primary be\ntoo corrupted to be useful in locating the secondary superblocks,\nthe program scans the filesystem until it finds and validates some\nsecondary superblocks. At that point, it generates a primary\nsuperblock."))),(0,a.kt)("h5",{id:"examples"},"Examples"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"These are just examples, replace drive ID with the correct drive\nsymbol, either an md number (md2, md15, etc) or an sd symbol (sdc1,\nsdj1, etc)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"xfs_repair -v /dev/md3")," -",">"," tests and reports, making changes\nwhen necessary"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"xfs_repair -nv /dev/sdc1")," -",">"," tests and reports without making\nchanges"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"xfs_repair -V")," -",">"," displays version and exits"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"xfs_repair")," -",">"," displays options and exits"),(0,a.kt)("li",{parentName:"ul"},"Note: As far as I can tell, these are the ONLY options we should be using.")),(0,a.kt)("h2",{id:"btrfs-scrub"},"btrfs scrub"),(0,a.kt)("p",null," For a full description, please see the ",(0,a.kt)("a",{parentName:"p",href:"https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs-scrub"},"man page for\nscrub"),"."),(0,a.kt)("h5",{id:"syntax-1"},"Syntax"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"The filesystem to be repaired must be mounted first.")," For Unraid,\nstart the array as normal, NOT in Maintenance mode!")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"btrfs scrub start [-BdqrR] `<path>`{=html}\\|`<device>`{=html}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Start a scrub on all devices of the filesystem identified by\n",(0,a.kt)("inlineCode",{parentName:"li"},"<path>"),"{=html} or on a single ",(0,a.kt)("inlineCode",{parentName:"li"},"<device>"),"{=html}."),(0,a.kt)("li",{parentName:"ul"},"Without options, scrub is started as a background process.\nScrubbing involves reading all data from all disks and verifying\nchecksums. Errors are corrected along the way IF POSSIBLE."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Unfortunately"),", the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command can detect but not fix\nerrors on single drives. If errors are detected, you will want\nto go to the ",(0,a.kt)("a",{parentName:"li",href:"#redoing-a-drive-formatted-with-btrfs"},"Redoing a drive formatted with\nBTRFS"),"\nsection."),(0,a.kt)("li",{parentName:"ul"},"If it's a drive pool, the ",(0,a.kt)("strong",{parentName:"li"},"scrub")," command can fix certain but\nnot all errors. So far there is not a reliable BTRFS tool that\ncan fix ALL possible errors. If the result indicates that there\nare still uncorrectable errors, then you will have to copy off\nall data and reformat the drive or pool anew (see ",(0,a.kt)("a",{parentName:"li",href:"#redoing-a-drive-formatted-with-btrfs"},"Redoing a\ndrive formatted with\nBTRFS"),").")),(0,a.kt)("h5",{id:"options-1"},"Options"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"-B",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Do not run in background; print scrub statistics when finished."))),(0,a.kt)("li",{parentName:"ul"},"-d",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Print separate statistics for each device of the filesystem (-B only)."))),(0,a.kt)("li",{parentName:"ul"},"-q",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Quiet. Omit error messages and statistics."))),(0,a.kt)("li",{parentName:"ul"},"-r",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Read only mode. Do not attempt to correct anything."))),(0,a.kt)("li",{parentName:"ul"},"-R",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Raw print mode. Print full data instead of summary.")))),(0,a.kt)("h5",{id:"examples-1"},"Examples"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Important Note! These are untested yet!")),(0,a.kt)("p",null,"These are just examples, replace drive ID with the correct drive\nsymbol, either cache or an md number (md2, md15, etc) or an sd\nsymbol (sdc1, sdj1, etc)."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"btrfs scrub start -B /dev/md3")," -",">"," tests and reports, making\nchanges when necessary"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"btrfs scrub start -rdB /dev/cache")," -",">"," tests and reports without\nmaking changes")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"-","-","- work in progress ","-","-","-")),(0,a.kt)("h2",{id:"reiserfsck"},"reiserfsck"),(0,a.kt)("p",null,"For a full description, please see the ",(0,a.kt)("a",{parentName:"p",href:"http://linux.about.com/library/cmd/blcmdl8_reiserfsck.htm"},"About.com page for\nreiserfsck"),"."),(0,a.kt)("h5",{id:"description-1"},"Description"),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck")," tool checks for a Reiser file system (must be a\npartition like /dev/md3 or /dev/sdc1, not a drive like /dev/sdc),\nreplays any transactions, and checks or repairs it."),(0,a.kt)("h5",{id:"syntax-examples"},"Syntax examples"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"The filesystem to be repaired must be unmounted.")," For Unraid,\nstart the array in Maintenance mode."),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Note: in the following examples, the option is preceded by 2\nhyphens. Drive 3 (/dev/md3) is just used as an example. If you were\ntesting Disk 13, you would use /dev/md13.")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"reiserfsck \\--check /dev/md3")," -",">"," checks file system for errors"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"reiserfsck \\--fix-fixable /dev/md3")," -",">"," fixes file system\nerrors"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"reiserfsck \\--rebuild-tree /dev/md3")," -",">"," rebuilds the file\nsystem (may have lost files)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"reiserfsck \\--rebuild-tree -S /dev/md3")," -",">"," rebuilds the file\nsystem from entire partition (may have lost files, may recover old\ndeleted files or their pieces)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"reiserfsck \\--rebuild-sb /dev/md3")," -",">"," rebuilds superblock based\non series of questions, answers MUST be accurate! Please see the\n",(0,a.kt)("a",{parentName:"li",href:"#rebuilding-the-superblock"},"Rebuilding the superblock"),"\nsection below.")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"-","-","- work in progress ","-","-","-")),(0,a.kt)("h5",{id:"rebuilding-the-superblock"},"Rebuilding the superblock"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"This is an example of the questions and correct answers, when you\nattempt to rebuild a ReiserFS superblock, using the\n",(0,a.kt)("strong",{parentName:"li"},"-","-rebuild-sb")," option. The answers MUST be accurate, or the file\nsystem may be damaged even more!"),(0,a.kt)("li",{parentName:"ul"},"The example below uses ",(0,a.kt)("strong",{parentName:"li"},"Disk 6")," (",(0,a.kt)("strong",{parentName:"li"},"/dev/md6"),"), so you need to\nchange that to the correct drive symbol for your drive."),(0,a.kt)("li",{parentName:"ul"},"It is assumed that you have followed the instruction above, and the\nfilesystem to be repaired is unmounted, the array is started in\nMaintenance mode."),(0,a.kt)("li",{parentName:"ul"},"The answers you should give are in ",(0,a.kt)("strong",{parentName:"li"},"bold")," below. Some of the\nnumbers reported will be different for your file system. The UUID\nwill be different too."),(0,a.kt)("li",{parentName:"ul"},"This is based on the experiences of two users, found\n",(0,a.kt)("a",{parentName:"li",href:"https://forums.unraid.net/forum/index.php?topic=1483"},"here")," and\n",(0,a.kt)("a",{parentName:"li",href:"https://forums.unraid.net/forum/index.php?topic=4021"},"here"),". We\nrecommend you read both, for more details."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"You may want to print this out ahead of time."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"       root@Tower:\\~# reiserfsck --rebuild-sb /dev/md6\n       reiserfsck 3.6.19 (2003 www.namesys.com)\n\n       *************************************************************\n       ** If you are using the latest reiserfsprogs and it fails **\n       ** please email bug reports to reiserfs-list@namesys.com, **\n       ** providing as much information as possible -- your **\n       ** hardware, kernel, patches, settings, all reiserfsck **\n       ** messages (including version), the reiserfsck logfile, **\n       ** check the syslog file for any related information. **\n       ** If you would like advice on using this program, support **\n       ** is available for $25 at www.namesys.com/support.html. **\n       *************************************************************\n       Will check superblock and rebuild it if needed\n       Will put log info to 'stdout'\n\n       Do you want to run this program?[N/Yes] (note need to type Yes\n       if you do):**Yes**\n\n       reiserfs_open: the reiserfs superblock cannot be found on\n       /dev/md6.\n\n       what the version of ReiserFS do you use[1-4]\n           (1) 3.6.x\n           (2) >=3.5.9 (introduced in the middle of 1999) (if you use linux 2.2, choose this one)\n           (3) < 3.5.9 converted to new format (don't choose if unsure)\n           (4) < 3.5.9 (this is very old format, don't choose if unsure)\n           (X) exit\n       **1**\n\n       Enter block size [4096]:\n       **4096**\n\n       No journal device was specified. (If journal is not available,\n       re-run with \\--no-journal-available option specified).\n       Is journal default? (y/n)[y]: **y**\n\n       Did you use resizer(y/n)[n]: **n**\n       rebuild-sb: no uuid found, a new uuid was generated\n        (b0894fe9-3850-4d57-b70b-a419cbf3823e)\n\n       rebuild-sb: You either have a corrupted journal or have just\n       changed the start of the partition with some partition table\n       editor. If you are sure that the start of the partition is ok,\n       rebuild the journal header.\n       Do you want to rebuild the journal header? (y/n)[n]: **y**\n       Reiserfs super block in block 16 on 0x906 of format 3.6 with\n       standard journal\n       Count of blocks on the device: 97677824\n       Number of bitmaps: 2981\n       Blocksize: 4096\n       Free blocks (count of blocks - used [journal, bitmaps, data,\n       reserved] blocks): 0\n       Root block: 0\n       Filesystem is NOT clean\n       Tree height: 0\n       Hash function used to sort names: not set\n       Objectid map size 0, max 972\n       Journal parameters:\n           Device [0x0]\n           Magic [0x0]\n           Size 8193 blocks (including 1 for journal header) (first block 18)\n           Max transaction length 1024 blocks\n           Max batch size 900 blocks\n           Max commit age 30\n       Blocks reserved by journal: 0\n       Fs state field: 0x1:\n           some corruptions exist.\n       sb_version: 2\n       inode generation number: 0\n       UUID: b0894fe9-3850-4d57-b70b-a419cbf3823e\n       LABEL:\n       Set flags in SB:\n       Is this ok ? (y/n)[n]: **y**\n")),(0,a.kt)("p",null,"It should be quick. When this completes, hopefully successfully, rerun\nthe ",(0,a.kt)("strong",{parentName:"p"},"reiserfsck ","-","-check")," on the drive, and proceed according to the\ninstructions that it gives you."),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"-","-","- work in progress ","-","-","-")))}u.isMDXComponent=!0}}]);