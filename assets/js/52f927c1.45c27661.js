"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9177],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>c});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(a),h=i,c=d["".concat(s,".").concat(h)]||d[h]||m[h]||r;return a?n.createElement(c,o(o({ref:t},u),{},{components:a})):n.createElement(c,o({ref:t},u))}));function c(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},5755:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var n=a(7462),i=(a(7294),a(3905));const r={},o="Managing VMs",l={unversionedId:"legacy/Manual/VM_Management",id:"legacy/Manual/VM_Management",title:"Managing VMs",description:"While Docker Containers are the preferred mechanism for running",source:"@site/docs/legacy/Manual/VM_Management.md",sourceDirName:"legacy/Manual",slug:"/legacy/Manual/VM_Management",permalink:"/legacy/Manual/VM_Management",draft:!1,editUrl:"https://github.com/unraid/docs/tree/main/docs/legacy/Manual/VM_Management.md",tags:[],version:"current",frontMatter:{},sidebar:"unraidSidebar",previous:{title:"VM Support",permalink:"/legacy/Manual/VM_Guest_Support"},next:{title:"Contribute",permalink:"/category/contribute"}},s={},p=[{value:"Determining HVM/IOMMU Hardware Support",id:"determining_hvmiommu_hardware_support",level:3},{value:"Assigning Graphics Devices",id:"assigning_graphics_devices",level:3},{value:"Adjust BIOS Settings",id:"adjust_bios_settings",level:2},{value:"Configure a Network Bridge",id:"configure_a_network_bridge",level:2},{value:"User Shares for Virtualization",id:"user_shares_for_virtualization",level:2},{value:"Setup Virtualization Preferences",id:"setup_virtualization_preferences",level:2},{value:"Basic VM Creation",id:"basic_vm_creation",level:2},{value:"Advanced Options",id:"advanced_options",level:2},{value:"Warning: Passing through a GPU to a SeaBIOS-based VM will disable console VGA access",id:"warning_passing_through_a_gpu_to_a_seabios_based_vm_will_disable_console_vga_access",level:2},{value:"Help! Failed to set iommu for container: Operation not permitted",id:"help_failed_to_set_iommu_for_container_operation_not_permitted",level:2},{value:"Help! I can start my VM with a GPU assigned but all I get is a black screen on my monitor!",id:"help_i_can_start_my_vm_with_a_gpu_assigned_but_all_i_get_is_a_black_screen_on_my_monitor",level:2},{value:"Edit XML for VM to supply GPU ROM manually",id:"edit_xml_for_vm_to_supply_gpu_rom_manually",level:3},{value:"Prerequisites",id:"prerequisites_1",level:2},{value:"Step 1: Identify the disk to be converted using the Unraid webGui",id:"step_1_identify_the_disk_to_be_converted_using_the_unraid_webgui",level:2},{value:"Step 2: Add a new Virtual Machine from the VMs tab",id:"step_2_add_a_new_virtual_machine_from_the_vms_tab",level:2},{value:"Step 3: Convert disk to image",id:"step_3_convert_disk_to_image",level:2},{value:"Step 4: Edit the XML for your virtual machine (Windows Guests Only)",id:"step_4_edit_the_xml_for_your_virtual_machine_windows_guests_only",level:2},{value:"Step 5: Install the VirtIO drivers from inside the VM (Windows Guests Only)",id:"step_5_install_the_virtio_drivers_from_inside_the_vm_windows_guests_only",level:2},{value:"Step 6: Remove the secondary vdisk from your VM (Windows Guests Only)",id:"step_6_remove_the_secondary_vdisk_from_your_vm_windows_guests_only",level:2},{value:"Extra: HELP! Stuck at SeaBIOS with &quot;Booting from Hard Disk&quot;",id:"extra_help_stuck_at_seabios_with_booting_from_hard_disk",level:2},{value:"Prerequisites",id:"prerequisites_2",level:2},{value:"Step 1: Preparing the disk",id:"step_1_preparing_the_disk",level:2},{value:"Step 2: Identify the physical disk to be used in the unRAID webGui",id:"step_2_identify_the_physical_disk_to_be_used_in_the_unraid_webgui",level:2},{value:"Step 3: Add a new Virtual Machine from the VMs tab",id:"step_3_add_a_new_virtual_machine_from_the_vms_tab",level:2},{value:"Step 4: Edit the XML for your virtual machine",id:"step_4_edit_the_xml_for_your_virtual_machine",level:2},{value:"Step 5: Installing drivers",id:"step_5_installing_drivers",level:2},{value:"Extra: HELP! Stuck at SeaBIOS with &quot;Booting from Hard Disk&quot;",id:"extra_help_stuck_at_seabios_with_booting_from_hard_disk_1",level:2},{value:"Windows Conversion Procedure",id:"windows_conversion_procedure",level:2},{value:"Step 1: Determine if your VM is using Xen&#39;s GPLPV drivers",id:"step_1_determine_if_your_vm_is_using_xens_gplpv_drivers",level:3},{value:"Step 2: Prepare Windows for GPLPV driver removal",id:"step_2_prepare_windows_for_gplpv_driver_removal",level:3},{value:"Step 3: Download the uninstaller and remove the GPLPV drivers",id:"step_3_download_the_uninstaller_and_remove_the_gplpv_drivers",level:3},{value:"Step 4: Create a new VM with the VM Manager",id:"step_4_create_a_new_vm_with_the_vm_manager",level:3},{value:"Step 5: Starting your new VM and loading the VirtIO drivers",id:"step_5_starting_your_new_vm_and_loading_the_virtio_drivers",level:3},{value:"Step 6: Remove the temporary vdisk and start the VM",id:"step_6_remove_the_temporary_vdisk_and_start_the_vm",level:3}],u={toc:p},d="wrapper";function m(e){let{components:t,...r}=e;return(0,i.kt)(d,(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"managing-vms"},"Managing VMs"),(0,i.kt)("h1",{id:"overview"},"Overview"),(0,i.kt)("p",null,"While Docker Containers are the preferred mechanism for running\nLinux-based applications such as media servers, backup software, and\nfile sharing solutions, virtual machines add support for non-Linux\nworkloads and the ability to utilize devices that the host cannot (think\ngraphics pass through, USB pass through/assignment, etc). ",(0,i.kt)("em",{parentName:"p"},"Localized\nVirtualization")," is our method of supporting VMs where all resources\nassigned to the guest are local to the host."),(0,i.kt)("p",null,"For information on what operating systems have been tested for use with\nUnraid Server OS, please see the ",(0,i.kt)("a",{parentName:"p",href:"Manual/VM_Guest_Support",title:"wikilink"},"VM Guest\nSupport")," wiki page."),(0,i.kt)("h1",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,'To create virtual machines on unRAID, you will need HVM hardware support\n(Intel VT-x or AMD-V). To assign host-based PCI devices to those VMs,\nyour hardware must also support IOMMU (Intel VT-d or AMD-Vi). Lastly,\nall virtualization features must be enabled in your motherboard BIOS\n(typically found in the CPU or System Agent sections). NOTE: Not all\nhardware that claims support for this has been proven to work\neffectively, so see the \\"tested hardware\\" section for known working\ncomponent combinations. Virtual machines can also drive a need for much\nmore RAM/CPU cores depending on the type. Here are some general\nrecommendations on how much RAM should be allocated ',(0,i.kt)("strong",{parentName:"p"},"per virtual\nmachine"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Virtual servers (Windows, Arch, etc.): 256MB - 1GB, 1-2 CPU cores"),(0,i.kt)("li",{parentName:"ul"},"Virtual desktops (Windows, Ubuntu, etc.): 512MB - 8GB, 2-4 CPU cores"),(0,i.kt)("li",{parentName:"ul"},"Hybrid VMs (GPU assignment, gaming, etc.): 1GB - 12GB, 2-6 CPU cores")),(0,i.kt)("p",null,"Keep in mind that memory usage for virtual machines only occurs when\nthey are running, so it\\'s just important to think about these\nrequirements in terms of peak concurrent usage on your system."),(0,i.kt)("h3",{id:"determining_hvmiommu_hardware_support"},"Determining HVM/IOMMU Hardware Support"),(0,i.kt)("p",null,"To determine if hardware has support for HVM or IOMMU, there are two\nprimary methods available:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Online Research")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"To check if your Intel processor has support for VT-x or VT-d, visit\n",(0,i.kt)("a",{parentName:"li",href:"http://ark.intel.com/Search/Advanced"},"http://ark.intel.com/Search/Advanced"),". \xa0On the left hand filter\npanel, you can filter by processors that have support for VT-x,\nVT-d, or both."),(0,i.kt)("li",{parentName:"ul"},"For guidance with AMD processors, there is not an equivalent to the\nARK site, but ",(0,i.kt)("a",{parentName:"li",href:"http://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware#AMD_based"},"this Wikipedia\narticle"),"\nmay assist you."),(0,i.kt)("li",{parentName:"ul"},"Motherboard support for virtualization is usually available as part\nof the product documentation or user manual.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Through the unRAID webGui")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"When accessing your unRAID system through the web interface, you can\ndetermine if your system is virtualization compatible by clicking\nthe ",(0,i.kt)("strong",{parentName:"li"},"Info")," button on the right side of the top menu bar.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"HVM Support")," refers to Intel VT-x or AMD-V",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Not Available")," means that your hardware is not HVM capable."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Disabled")," means that your hardware is HVM capable, but the\nsettings in your motherboard BIOS are not enabled."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Enabled")," means that your hardware is both HVM capable and\nthe appropriate settings in your motherboard BIOS are also\nenabled."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"IOMMU Support")," refers to Intel VT-d or AMD-Vi",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Not Available")," only displays if your system is not HVM\ncapable."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Disabled")," means that either your hardware is not capable of\nIOMMU or the appropriate settings in your motherboard BIOS\nare not enabled."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Enabled")," means that your hardware is both IOMMU capable and\nthe appropriate settings in your motherboard BIOS are also\nenabled.")))))),(0,i.kt)("h3",{id:"assigning_graphics_devices"},"Assigning Graphics Devices"),(0,i.kt)("p",null,"Unlike other PCI devices, graphics devices can be more difficult to pass\nthrough to a VM for control. With unRAID 6, we\\'ve implemented a number\nof tweaks to maximize success with graphics pass through for our users.\nHere are the currently known limitations associated with GPU pass\nthrough on unRAID 6:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"NVIDIA GTX-series GPUs should work fine as of the 600 series or\nnewer, but not all models have been tested."),(0,i.kt)("li",{parentName:"ul"},"AMD cards have had some issues depending on the make or model and\nwhich guest operating system is attached."),(0,i.kt)("li",{parentName:"ul"},"Some devices may work better for pass through to specific guest\noperating systems."),(0,i.kt)("li",{parentName:"ul"},"With OVMF-based virtual machines, if your GPU has UEFI support, it\nshould work fine, but some users still report card-specific issues."),(0,i.kt)("li",{parentName:"ul"},"In addition to the ",(0,i.kt)("a",{parentName:"li",href:"UnRAID_Manual_6#Lime_Technology_Tested_Components",title:"wikilink"},"Lime Technology Tested\nComponents"),",\nyou can review a ",(0,i.kt)("a",{parentName:"li",href:"https://docs.google.com/spreadsheets/d/1LnGpTrXalwGVNy0PWJDURhyxa3sgqkGXmvNCIvIMenk/edit#gid=0"},"community-maintained\nspreadsheet"),"\nof tested hardware configurations for GPU assignment."),(0,i.kt)("li",{parentName:"ul"},"More information on assigning graphics devices to VMs can be found\n",(0,i.kt)("a",{parentName:"li",href:"UnRAID_Manual_6#Assigning_Graphics_Devices_to_Virtual_Machines_.28GPU_Pass_Through.29",title:"wikilink"},"here"),".")),(0,i.kt)("h1",{id:"system_preparation"},"System Preparation"),(0,i.kt)("p",null,"Before you can get started with creating virtual machines, there are a\nfew preparatory tasks that must be completed."),(0,i.kt)("h2",{id:"adjust_bios_settings"},"Adjust BIOS Settings"),(0,i.kt)("p",null,"In order to utilize all the virtualization features of Unraid 6, you\nmust ensure your BIOS is configured properly for hardware-assisted\nvirtualization as well as IO memory mapping (HVM / IOMMU support). In\nyour BIOS settings, look for anything marked with ",(0,i.kt)("strong",{parentName:"p"},"Virtualization"),",\n",(0,i.kt)("strong",{parentName:"p"},"Intel VT-x"),", ",(0,i.kt)("strong",{parentName:"p"},"Intel VT-d"),", ",(0,i.kt)("strong",{parentName:"p"},"AMD-V"),", or ",(0,i.kt)("strong",{parentName:"p"},"AMD-Vi")," and set it to\n",(0,i.kt)("strong",{parentName:"p"},"Enabled"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(6075).Z,width:"606",height:"382"}),'{width="150"}\n',(0,i.kt)("img",{src:a(9745).Z,width:"600",height:"365"}),'{width="150"}\n',(0,i.kt)("img",{src:a(9999).Z,width:"800",height:"600"}),'{width="150"}\n',(0,i.kt)("img",{src:a(9898).Z,width:"1024",height:"768"}),'{width="150"}'),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"examples of where virtualization settings can be found from various\nmotherboard BIOS screens.")),(0,i.kt)("h2",{id:"configure_a_network_bridge"},"Configure a Network Bridge"),(0,i.kt)("p",null,"There are two methods by which your virtual machines can get access to\nhost-based networking: through a private NAT bridge managed by libvirt\nor through a public bridge managed by Unraid directly. The private\nbridge (virbr0) is automatically configured when libvirt starts. The\npublic bridge (br0) can be created through the ",(0,i.kt)("em",{parentName:"p"},"Network Settings")," page\non the Unraid webGui."),(0,i.kt)("p",null,"The private bridge generates an internal DHCP server/address pool to\ncreate IPs for VMs automatically, but the VMs will be on a subnet that\ncannot be accessed by other devices or even other services on Unraid.\nThis type of bridge is ideal if you want your VM to be completely\nisolated from all other network services except internet access and the\nhost\\'s network file sharing protocols. VM management can be performed\nthrough a VNC session provided by the browser."),(0,i.kt)("p",null,"The public bridge provides VMs with an IP address from your router, but\ninternally bridges communications between VMs and each other, as well as\nthe host. This type of bridge is ideal if you want your VMs to act just\nlike another device on your network, where you manage its network access\nat the LAN-router instead of inside the VM. We persist MAC address\nsettings for the virtual interfaces you create, ensuring the VMs should\nget the same IP address each time they connect, as long as your\nrouter-managed DHCP pool doesn\\'t run out of addresses. So if you want\nto connect to your VM from another PC, laptop, tablet, or another type\nof device, you should use the public bridge. Enable public bridge in\n",(0,i.kt)("em",{parentName:"p"},"Network settings ",">"," Enable bridging: Yes")),(0,i.kt)("p",null,"Whichever bridge you prefer can be defined as the ",(0,i.kt)("em",{parentName:"p"},"Default Network\nBridge")," on the ",(0,i.kt)("strong",{parentName:"p"},"VM Settings")," page. You may have to enable the\n",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Advanced"))," view using the toggle at the top right before this\nsetting is visible."),(0,i.kt)("h2",{id:"user_shares_for_virtualization"},"User Shares for Virtualization"),(0,i.kt)("p",null,"By default, Unraid will create two user shares for use with\nvirtualization on Unraid. One share to store your installation media\nfiles (ISOs) and another to store your virtual machines themselves\n(domains). If you don\\'t already have a share you use for backups, you\nmight consider adding one as well to use for backing up your virtual\nmachines."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Recommendations for Share Configuration")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Virtual machines will perform best when their primary vDisk is\nstored on a cache-only share."),(0,i.kt)("li",{parentName:"ul"},"While SSDs are not required for virtual machines to function,\nperformance gains are substantial with their use."),(0,i.kt)("li",{parentName:"ul"},"For your ISO library share (containing your installation media),\ncache usage is optional.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"IMPORTANT: Do NOT store your active virtual machines on a share where\nthe"),"Use Cache",(0,i.kt)("em",{parentName:"p"},"setting is set to ",(0,i.kt)("strong",{parentName:"em"},"Yes"),". Doing so will cause your VMs to\nbe moved to the array when the mover is invoked.")),(0,i.kt)("h2",{id:"setup_virtualization_preferences"},"Setup Virtualization Preferences"),(0,i.kt)("p",null,"Before you can get started creating virtual machines, we need to perform\na few configuration steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Use your web browser to navigate to the ",(0,i.kt)("em",{parentName:"li"},"VM Manager Settings")," page\n(",(0,i.kt)("em",{parentName:"li"},"Settings")," -",">"," ",(0,i.kt)("em",{parentName:"li"},"VM Manager"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"For Windows VMs"),", you will need to download virtual drivers for\nstorage, network, and memory.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Download the latest \\'stable\\' VirtIO Windows drivers ISO found\nhere:\n",(0,i.kt)("a",{parentName:"li",href:"https://fedoraproject.org/wiki/Windows_Virtio_Drivers#Direct_download"},"https://fedoraproject.org/wiki/Windows_Virtio_Drivers#Direct_download")),(0,i.kt)("li",{parentName:"ul"},"Copy the ISO file for the drivers to the ISO Library Share that\nyou created earlier"),(0,i.kt)("li",{parentName:"ul"},"Use the file picker for ",(0,i.kt)("strong",{parentName:"li"},"VirtIO Windows Drivers ISO")," to select\nthe ISO file you copied"),(0,i.kt)("li",{parentName:"ul"},"You can override the default driver ISO on a per-VM basis (under\n",(0,i.kt)("strong",{parentName:"li"},"Advanced View"),")."))),(0,i.kt)("li",{parentName:"ul"},"Select ",(0,i.kt)("strong",{parentName:"li"},"virbr0")," (default) for a ",(0,i.kt)("em",{parentName:"li"},"private network bridge")," or select\na ",(0,i.kt)("em",{parentName:"li"},"public network bridge")," that you created on the ",(0,i.kt)("em",{parentName:"li"},"Network Settings"),"\npage.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"You can override the default network bridge on a per-VM basis\n(under ",(0,i.kt)("strong",{parentName:"li"},"Advanced View"),")."))),(0,i.kt)("li",{parentName:"ul"},"Toggle ",(0,i.kt)("strong",{parentName:"li"},"PCIe ACS Override")," to ",(0,i.kt)("strong",{parentName:"li"},"On")," if you wish to assign\nmultiple PCI devices to disparate virtual machines",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The override breaks apart IOMMU groups so that individual\ndevices can be assigned to different virtual machines"),(0,i.kt)("li",{parentName:"ul"},"Without this setting enabled, you may not be able to pass\nthrough devices to multiple virtual machines simultaneously"),(0,i.kt)("li",{parentName:"ul"},"WARNING: This setting is experimental! Take caution when using.\n",(0,i.kt)("a",{parentName:"li",href:"http://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html"},"1")))),(0,i.kt)("li",{parentName:"ul"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Apply")," when done to apply your settings")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Troubleshoot: If it says stopped after clicking apply, check\n",(0,i.kt)("strong",{parentName:"li"},"/boot/config/domains.cfg"),", you may need to set fields: (See also\n",(0,i.kt)("a",{parentName:"li",href:"https://forums.unraid.net/topic/70874-restoring-virtual-machines/?tab=comments#comment-650785"},"Forum help by\nSquid"),")",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},'MEDIADIR="/mnt/user/system/"')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},'VIRTIOISO="/mnt/user/system"')," (the share with virtio image)")))),(0,i.kt)("h1",{id:"creating_your_own_virtual_machines"},"Creating Your Own Virtual Machines"),(0,i.kt)("p",null,"With the preparation steps completed, you can create your first VM by\nclicking ",(0,i.kt)("strong",{parentName:"p"},"Add VM")," from the ",(0,i.kt)("em",{parentName:"p"},"Virtual Machines")," page."),(0,i.kt)("h2",{id:"basic_vm_creation"},"Basic VM Creation"),(0,i.kt)("p",null,"The webGui will by default present the minimum number of fields required\nin order for you to create a VM."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Set the ",(0,i.kt)("strong",{parentName:"li"},"Template")," type to ",(0,i.kt)("strong",{parentName:"li"},"Custom")),(0,i.kt)("li",{parentName:"ul"},"Give the VM a ",(0,i.kt)("strong",{parentName:"li"},"Name")," and a ",(0,i.kt)("strong",{parentName:"li"},"Description")),(0,i.kt)("li",{parentName:"ul"},"Toggle the ",(0,i.kt)("strong",{parentName:"li"},"Autostart")," setting if you want the VM to start with\nthe array automatically"),(0,i.kt)("li",{parentName:"ul"},"Select the ",(0,i.kt)("strong",{parentName:"li"},"Operating System")," you wish to use, which will also\nadjust the icon used for the VM"),(0,i.kt)("li",{parentName:"ul"},"Select which ",(0,i.kt)("strong",{parentName:"li"},"CPUs")," you wish to assign the VM",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"You can select up to as many physical CPUs that are present on\nyour host"))),(0,i.kt)("li",{parentName:"ul"},"Specify how much ",(0,i.kt)("strong",{parentName:"li"},"Initial Memory")," you wish to assign the VM",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"See the documentation for the OS you are installing to determine\nhow much RAM to allocate."))),(0,i.kt)("li",{parentName:"ul"},"Select an ",(0,i.kt)("strong",{parentName:"li"},"OS Install ISO")," for your installation media"),(0,i.kt)("li",{parentName:"ul"},"Specify the vDisks you wish to create (or select an existing vDisk)",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("strong",{parentName:"li"},"Primary vDisk")," is used to store your VM\\'s operating\nsystem"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Additional vDisks")," can be added by clicking\n",(0,i.kt)("img",{src:a(8372).Z,width:"36",height:"40"}),'{width="15"}'))),(0,i.kt)("li",{parentName:"ul"},"Specify a ",(0,i.kt)("strong",{parentName:"li"},"Graphics Card")," to use to interact with the VM",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"If you are ",(0,i.kt)("em",{parentName:"li"},"NOT")," assigning a physical graphics card, specify\n",(0,i.kt)("strong",{parentName:"li"},"VNC")),(0,i.kt)("li",{parentName:"ul"},"If you ",(0,i.kt)("em",{parentName:"li"},"ARE")," assigning a physical graphics card, select it from\nthe list"),(0,i.kt)("li",{parentName:"ul"},"VNC can only be specified as the primary graphics display or it\ncan\\'t be assigned at all"),(0,i.kt)("li",{parentName:"ul"},"A password can be optionally specified for the VNC connection"),(0,i.kt)("li",{parentName:"ul"},"Not all graphics cards will work as a secondary display"),(0,i.kt)("li",{parentName:"ul"},"If you assign a physical graphics device, be sure to assign a\nUSB keyboard and mouse as well"),(0,i.kt)("li",{parentName:"ul"},"Additional graphics devices can be assigned by clicking\n",(0,i.kt)("img",{src:a(8372).Z,width:"36",height:"40"}),'{width="15"}'))),(0,i.kt)("li",{parentName:"ul"},"Assign a ",(0,i.kt)("strong",{parentName:"li"},"Sound Card")," if you\\'re assigning a graphics card to get\naudio support in your VM",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Most GPUs have their own built-in sound card as a function of\nthe graphics card for HDMI audio"),(0,i.kt)("li",{parentName:"ul"},"Additional sound cards can be assigned by clicking\n",(0,i.kt)("img",{src:a(8372).Z,width:"36",height:"40"}),'{width="15"}'))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"USB Devices")," can be assigned to the VM that are plugged into the\nhost",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"USB hot-plugging is not currently supported, so devices must be\nattached before the VM is started in order for USB pass through\nto function"),(0,i.kt)("li",{parentName:"ul"},"Some USB devices may not work properly when passed through to a\nguest (though most do work fine)"),(0,i.kt)("li",{parentName:"ul"},"The Unraid USB flash device is not displayed here, to prevent\naccidental assignment"))),(0,i.kt)("li",{parentName:"ul"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Create VM")," to create your virtual disks (if necessary),\nwhich will start automatically unless you unchecked the ",(0,i.kt)("strong",{parentName:"li"},"Start VM\nafter creation")," checkbox.")),(0,i.kt)("h2",{id:"advanced_options"},"Advanced Options"),(0,i.kt)("p",null,"If you wish to toggle other advanced settings for the VM, you can toggle\nfrom ",(0,i.kt)("strong",{parentName:"p"},"Basic")," to ",(0,i.kt)("strong",{parentName:"p"},"Advanced View")," (switch located on the ",(0,i.kt)("em",{parentName:"p"},"Template\nSettings")," section bar from the ",(0,i.kt)("em",{parentName:"p"},"Add VM")," page)."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You can adjust the ",(0,i.kt)("strong",{parentName:"li"},"CPU Mode")," setting",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Host Passthrough")," will expose the guest to all the\ncapabilities of the host CPU (this can significantly improve\nperformance)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Emulated")," will use the QEMU emulated CPU and ",(0,i.kt)("em",{parentName:"li"},"not")," expose the\nguest to all of the host processor\\'s features"))),(0,i.kt)("li",{parentName:"ul"},"Specifying a ",(0,i.kt)("strong",{parentName:"li"},"Max Memory")," value will enable memory ballooning,\nallowing KVM to shrink/expand memory assignments dynamically as\nneeded.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"This feature does not apply to VMs where a physical PCI device\nhas been assigned (GPU, sound, etc.)"))),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("strong",{parentName:"li"},"Machine")," type presented to your VM can be toggled between\nQEMU\\'s ",(0,i.kt)("strong",{parentName:"li"},"i440fx")," or ",(0,i.kt)("strong",{parentName:"li"},"Q35")," chipsets",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"For Windows-based VMs"),", i440fx is the default setting and\nshould only be changed if you are having difficulty passing\nthrough a PCI-based graphics card (this may prompt Windows to\nreactivate)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"For Linux-based VMs"),", Q35 is the default setting and should not\nbe changed if passing through a GPU"))),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("strong",{parentName:"li"},"BIOS")," can only be adjusted when adding a new VM (existing VMs\ncannot modify this setting).",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"SeaBIOS is a traditional VGA BIOS for creating most virtual\nmachines"),(0,i.kt)("li",{parentName:"ul"},"OVMF utilizes a UEFI BIOS interface, eliminating the use of\ntraditional VGA"),(0,i.kt)("li",{parentName:"ul"},"OVMF requires that the VM\\'s operating system supports UEFI\n(Windows 8 or newer, most modern Linux distros) and if you wish\nto assign a physical graphics device, it too must support UEFI"))),(0,i.kt)("li",{parentName:"ul"},"If you specify Windows as the guest operating system, you can toggle\nthe exposure of ",(0,i.kt)("strong",{parentName:"li"},"Hyper-V")," extensions to the VM"),(0,i.kt)("li",{parentName:"ul"},"You can choose to override the default ",(0,i.kt)("strong",{parentName:"li"},"VirtIO Drivers ISO")," should\nyou so desire"),(0,i.kt)("li",{parentName:"ul"},"You can toggle the ",(0,i.kt)("strong",{parentName:"li"},"vDisk Type")," between RAW and QCOW2 (RAW is\nrecommended for best performance)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"With Linux-based VMs"),", you can add multiple ",(0,i.kt)("strong",{parentName:"li"},"VirtFS")," mappings to\nyour guest",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"For more information on VirtFS and the 9p file system, visit\nhere: ",(0,i.kt)("a",{parentName:"li",href:"http://wiki.qemu.org/Documentation/9psetup"},"http://wiki.qemu.org/Documentation/9psetup")))),(0,i.kt)("li",{parentName:"ul"},"If you desire, you can modify the ",(0,i.kt)("strong",{parentName:"li"},"Network MAC")," address for the\nvirtual network interface of the VM as well as specify an alternate\n",(0,i.kt)("strong",{parentName:"li"},"Network Bridge"),".",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"You can click the blue refresh symbol to auto-generate a new MAC\naddress for the virtual network interface."),(0,i.kt)("li",{parentName:"ul"},"Additional virtual network interfaces can be assigned by\nclicking ",(0,i.kt)("img",{src:a(8372).Z,width:"36",height:"40"}),'{width="15"}')))),(0,i.kt)("h1",{id:"expanding_a_vdisk"},"Expanding a vdisk"),(0,i.kt)("p",null,"In the event that you need to increase the size of your virtual disk\ndevice, you can do so with the following procedure:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Navigate to the VMs tab in the webGui."),(0,i.kt)("li",{parentName:"ul"},"Make sure your VM is stopped."),(0,i.kt)("li",{parentName:"ul"},"Click on the name of your VM to expand the view to show you the\nvarious disk devices attached to the VM."),(0,i.kt)("li",{parentName:"ul"},"Click on the value in the capacity field for the vdisk to make it\neditable."),(0,i.kt)("li",{parentName:"ul"},"Edit a value of how large you want the vdisk to be and press enter\n(e.g. for 100 gigabytes, enter 100G)"),(0,i.kt)("li",{parentName:"ul"},"You will now see the new capacity take affect.")),(0,i.kt)("p",null,"After doing this, you can start your VM and the new storage will be\navailable, though you will need to either create a new partition out of\nthat space or extend an existing partition to make use of it. For\ninstructions on how to expand your Windows partition, please see ",(0,i.kt)("a",{parentName:"p",href:"Articles/Expanding_Windows_VM_vdisk_partitions",title:"wikilink"},"this\narticle"),"."),(0,i.kt)("h1",{id:"troubleshooting_stuck_at_uefi_shell"},"Troubleshooting Stuck at UEFI Shell"),(0,i.kt)("p",null,"In the event you are stuck at the UEFI shell after booting your VM, you\ncan enter a few commands to manually trigger the boot sequence:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"fs0:"),"\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"cd\xa0efi/boot"),"\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"bootx64.efi")),(0,i.kt)("p",null,"This will manually trigger your VM to boot."),(0,i.kt)("h1",{id:"assigning_graphics_devices_to_virtual_machines_gpu_pass_through"},"Assigning Graphics Devices to Virtual Machines (GPU Pass Through)"),(0,i.kt)("p",null,"The ability to assign a GPU to a virtual machine for direct I/O control\ncomes with some additional provisions:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Not all motherboard/GPU combinations will work for GPU assignment."),(0,i.kt)("li",{parentName:"ol"},"Integrated graphics devices (on-board GPUs) are not assignable to\nvirtual machines at this time."),(0,i.kt)("li",{parentName:"ol"},"Additional community-tested configurations can be found in ",(0,i.kt)("a",{parentName:"li",href:"https://docs.google.com/spreadsheets/d/1LnGpTrXalwGVNy0PWJDURhyxa3sgqkGXmvNCIvIMenk/edit#gid=0"},"this\nspreadsheet"),"."),(0,i.kt)("li",{parentName:"ol"},"Lime Technology provides a list of validated and tested hardware\ncombinations within the wiki."),(0,i.kt)("li",{parentName:"ol"},"You can also discuss hardware selection in the ",(0,i.kt)("a",{parentName:"li",href:"http://lime-technology.com/forum/"},"Lime Technology\ncommunity forums"),".")),(0,i.kt)("p",null,"Additional information regarding virtual function I/O (VFIO) and GPU\npass through can be found in ",(0,i.kt)("a",{parentName:"p",href:"http://vfio.blogspot.com/2014/08/vfiovga-faq.html"},"the following F.A.Q from Alex\nWilliamson"),", the\nproject\\'s maintainer."),(0,i.kt)("h2",{id:"warning_passing_through_a_gpu_to_a_seabios_based_vm_will_disable_console_vga_access"},"Warning: Passing through a GPU to a SeaBIOS-based VM will disable console VGA access"),(0,i.kt)("p",null,"If you rely upon a locally-attached monitor and keyboard to interact\nwith the Unraid terminal directly, you will lose this ability once you\ncreate a SeaBIOS VM with a GPU assigned. This is due to a bug with VGA\narbitration and cannot be solved. This does NOT affect your ability to\naccess the console using a telnet or SSH session, but local console\naccess directly will appear to be frozen (blinking cursor, but no\nvisible response to keyboard input). It does not matter if you are using\non-board graphics for the console compared to a discrete GPU for the\npass through to a VM or not. With OVMF, however, VGA isn\\'t utilized,\ntherefore arbitration isn\\'t needed and therefore your console graphics\nwill remain intact. Note that not all GPUs support OVMF as OVMF requires\nUEFI support on your GPU."),(0,i.kt)("h2",{id:"help_failed_to_set_iommu_for_container_operation_not_permitted"},"Help! Failed to set iommu for container: Operation not permitted"),(0,i.kt)("p",null,"If you are getting the above message when trying to assign a graphics\ndevice to a VM, it is most likely that your device is in an IOMMU group\nalong with another active/in-use device on your system. Please see ",(0,i.kt)("a",{parentName:"p",href:"http://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html"},"this\narticle"),"\nwritten by Alex Williamson on IOMMU groups if you wish to better\nunderstand this issue and how it impacts you. Under ",(0,i.kt)("em",{parentName:"p"},"Settings")," -",">"," ",(0,i.kt)("em",{parentName:"p"},"VM\nManager")," you will find an option to toggle for PCIe ACS Override, which\nwill forcibly break out each device into its own IOMMU group (following\na reboot of the system). This setting is experimental, so use with\ncaution."),(0,i.kt)("p",null,"Another possibility here is that your system doesn\\'t support interrupt\nremapping, which is critical for VFIO and GPU pass through. There is a\nworkaround for this, but you will not be protected against MSI-based\ninterrupt injection attacks by guests (",(0,i.kt)("a",{parentName:"p",href:"http://invisiblethingslab.com/resources/2011/Software%20Attacks%20on%20Intel%20VT-d.pdf"},"more info about MSI injection\nattacks through\nVT-d"),").\nIf you completely trust your VM guests and the drivers inside them,\nenabling this workaround should resolve the issue. The alternative is to\npurchase hardware that offers interrupt remapping support. To enable the\nworkaround, you will need to modify your syslinux.cfg file, adding the\nbolded bit below:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0label\xa0Unraid\xa0OS"),"\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0menu\xa0default"),"\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0kernel\xa0/bzimage"),"\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0append\xa0"),(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"vfio_iommu_type1.allow_unsafe_interrupts=1")),(0,i.kt)("inlineCode",{parentName:"p"},"\xa0initrd=/bzroot")),(0,i.kt)("h2",{id:"help_i_can_start_my_vm_with_a_gpu_assigned_but_all_i_get_is_a_black_screen_on_my_monitor"},"Help! I can start my VM with a GPU assigned but all I get is a black screen on my monitor!"),(0,i.kt)("p",null,"If you aren\\'t receiving an error message, but the display doesn\\'t\n\\\"light up\\\" when your VM is started, it means that while the device is\nbeing assigned properly, you may have an issue with your motherboard or\nGPU preventing proper VGA arbitration from occurring. There are several\nthings you can do to try to fix this:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Boot into your motherboard BIOS and make sure your primary graphics\nis NOT set to a card you wish to pass through (the best option is to\nset it to integrated graphics, aka iGPU; make sure it\\'s not PCI or\nPCIe)."),(0,i.kt)("li",{parentName:"ul"},"Ensure your motherboard BIOS ",(0,i.kt)("em",{parentName:"li"},"and")," video card BIOS are up to date."),(0,i.kt)("li",{parentName:"ul"},"Try adjusting the ",(0,i.kt)("strong",{parentName:"li"},"BIOS")," under ",(0,i.kt)("strong",{parentName:"li"},"Advanced View")," when adding a new\nVM from ",(0,i.kt)("em",{parentName:"li"},"SeaBIOS")," to ",(0,i.kt)("em",{parentName:"li"},"OVMF")," (existing VMs cannot have this setting\nchanged once created)."),(0,i.kt)("li",{parentName:"ul"},"Try adjusting the ",(0,i.kt)("strong",{parentName:"li"},"Machine Type")," from ",(0,i.kt)("em",{parentName:"li"},"i440fx")," to ",(0,i.kt)("em",{parentName:"li"},"Q35")," under\n",(0,i.kt)("strong",{parentName:"li"},"Advanced View")," when editing or adding a VM."),(0,i.kt)("li",{parentName:"ul"},"As a last resort, you can attempt to manually provide the ROM file\nfor your video card by editing the XML for your VM (see below\nprocedure).")),(0,i.kt)("h3",{id:"edit_xml_for_vm_to_supply_gpu_rom_manually"},"Edit XML for VM to supply GPU ROM manually"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"From another PC, navigate to this webpage:\n",(0,i.kt)("a",{parentName:"li",href:"http://www.techpowerup.com/vgabios/"},"http://www.techpowerup.com/vgabios/")),(0,i.kt)("li",{parentName:"ul"},"Use the ",(0,i.kt)("strong",{parentName:"li"},"Refine Search Parameters")," section to locate your GPU from\nthe database."),(0,i.kt)("li",{parentName:"ul"},"Download the appropriate ROM file for your video card and store the\nfile on any user share in Unraid."),(0,i.kt)("li",{parentName:"ul"},"With your VM stopped, click the icon for your VM, then select ",(0,i.kt)("strong",{parentName:"li"},"Edit\nXML")," from the context menu."),(0,i.kt)("li",{parentName:"ul"},"Scroll to the bottom of the XML and locate this section (the\n",(0,i.kt)("inlineCode",{parentName:"li"},"<code>"),"{=html}",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-{=html}"},"<address>\n")),(0,i.kt)("inlineCode",{parentName:"li"},"</code>"),"{=html} parts may look different for you than from the\nexample below):")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<code>"),"{=html}"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0``<hostdev mode='subsystem' type='pci' managed='yes'>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<driver name='vfio'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"        <address domain='0x0000' bus='0x02' slot='0x00' function='0x0'/>\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-{=html}"},"<address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``</hostdev>"),"{=html}",(0,i.kt)("inlineCode",{parentName:"p"},"</code>"),"{=html}"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"After the ",(0,i.kt)("inlineCode",{parentName:"li"},"<code>"),"{=html}",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-{=html}"},"</source>\n")),(0,i.kt)("inlineCode",{parentName:"li"},"</code>"),"{=html} tag, add the following code:")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<rom file='/mnt/user/sharename/foldername/rom.bin'/>"),"{=html}"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Change the path after /mnt/user/ to the actual user share /\nsub-folder path to your romfile.")),(0,i.kt)("p",null,"Once done editing the XML, click ",(0,i.kt)("strong",{parentName:"p"},"Update")," and try starting your VM\nagain to see if the GPU assignment works properly."),(0,i.kt)("h1",{id:"physical_to_virtual_machine_conversion"},"Physical to Virtual Machine Conversion"),(0,i.kt)("p",null,"If you have an existing physical PC or server that you wish to convert\nto a virtual machine for use on unRAID 6, the process is fairly simple.\nSteps 1-3 apply for almost any modern Linux-based guest. Steps 4-6 apply\nfor Windows-based guests."),(0,i.kt)("h2",{id:"prerequisites_1"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Your system must meet the hardware requirements and complete these\npreparation steps before utilizing virtual machines on Unraid Server\nOS 6."),(0,i.kt)("li",{parentName:"ul"},"You must have enough disk space available on a single storage device\nin your array (total free space in the cache pool) that is equal to\nor greater in size than the physical disk you wish to convert."),(0,i.kt)("li",{parentName:"ul"},"It is highly encouraged to make a complete backup of your most\nimportant files before attempting a conversion.")),(0,i.kt)("h2",{id:"step_1_identify_the_disk_to_be_converted_using_the_unraid_webgui"},"Step 1: Identify the disk to be converted using the Unraid webGui"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"With the array stopped, attach the physical disk you wish to convert\nto your server (SATA and power)"),(0,i.kt)("li",{parentName:"ul"},"Login to your webGui for unRAID 6 using a browser (http://tower or\n",(0,i.kt)("a",{parentName:"li",href:"http://tower.local"},"http://tower.local")," from a Mac OS X device by default)"),(0,i.kt)("li",{parentName:"ul"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Main")," tab."),(0,i.kt)("li",{parentName:"ul"},"If the array hasn't been started yet, start it by clicking\n",(0,i.kt)("strong",{parentName:"li"},"Start"),"."),(0,i.kt)("li",{parentName:"ul"},"Locate your disk device from the ",(0,i.kt)("strong",{parentName:"li"},"Unassigned Devices")," section on\nthe Main tab."),(0,i.kt)("li",{parentName:"ul"},"Under the identification column, notate the disk id by ",(0,i.kt)("strong",{parentName:"li"},"letter\nhandle")," (e.g. sdb, sdc, sdd, sde, ...)"),(0,i.kt)("li",{parentName:"ul"},"Also make note of the ",(0,i.kt)("strong",{parentName:"li"},"size"),", as you will need at least this much\nspace free on an available array device or the cache (pool) to\ncreate your new virtual disk.")),(0,i.kt)("h2",{id:"step_2_add_a_new_virtual_machine_from_the_vms_tab"},"Step 2: Add a new Virtual Machine from the VMs tab"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Login to your webGui for Unraid 6 using a browser (http://tower or\n",(0,i.kt)("a",{parentName:"li",href:"http://tower.local"},"http://tower.local")," from a Mac OS X device by default)"),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"VMs")," tab (if the tab isn't visible, you haven't\n",(0,i.kt)("a",{parentName:"li",href:"http://lime-technology.com/wiki/index.php/UnRAID_Manual_6#System_Preparation"},"completed these preparation\nsteps"),"\nor may not meet the hardware requirements; post in ",(0,i.kt)("a",{parentName:"li",href:"http://lime-technology.com/forum/index.php?board=71.0"},"general\nsupport")," for\nfurther assistance)"),(0,i.kt)("li",{parentName:"ul"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Add VM")," button."),(0,i.kt)("li",{parentName:"ul"},"Follow ",(0,i.kt)("a",{parentName:"li",href:"Manual/VM_Management#Creating_Your_Own_Virtual_Machines",title:"wikilink"},"this\nguide"),"\nto create your VM, making sure to adhere to these specific settings:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Leave the ",(0,i.kt)("strong",{parentName:"li"},"BIOS")," setting to SeaBIOS."),(0,i.kt)("li",{parentName:"ul"},"Leave ",(0,i.kt)("strong",{parentName:"li"},"OS Install ISO")," blank."),(0,i.kt)("li",{parentName:"ul"},"Be sure to have the ",(0,i.kt)("strong",{parentName:"li"},"VirtIO Drivers ISO")," specified, you will\nneed these in a later step."),(0,i.kt)("li",{parentName:"ul"},"Make the ",(0,i.kt)("strong",{parentName:"li"},"primary virtual disk")," large enough for the physical\ndisk you are copying."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"If converting a disk containing a Windows OS"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Add a ",(0,i.kt)("strong",{parentName:"li"},"second virtual disk")," by clicking the green plus\nsymbol"),(0,i.kt)("li",{parentName:"ul"},"Make the size of this second virtual disk ",(0,i.kt)("strong",{parentName:"li"},"1M"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Uncheck")," the option to ",(0,i.kt)("strong",{parentName:"li"},"Start VM after creation"))))))),(0,i.kt)("h2",{id:"step_3_convert_disk_to_image"},"Step 3: Convert disk to image"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Utilizing a telnet or SSH capable client, connect to your Unraid\nsystem over a Local Area Network. The default username is root and\nthere is no password by default."),(0,i.kt)("li",{parentName:"ul"},"Enter the following command to begin the conversion of your physical\ndisk to a virtual image:")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"qemu-img convert -p -O raw /dev/sdX /mnt/user/vdisk_share/vmname/vdisk1.img")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Replace ",(0,i.kt)("strong",{parentName:"li"},"sdX")," with the device letter handle you noted in step 1,\nreplace ",(0,i.kt)("strong",{parentName:"li"},"vdisk_share")," with the share you created to store your\nvirtual disks, and replace ",(0,i.kt)("strong",{parentName:"li"},"vmname")," with the name you gave it when\nyou created it in step 2."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("strong",{parentName:"li"},"-p")," tag will output progress in the form of a percentage\nwhile the conversion is occurring.")),(0,i.kt)("h2",{id:"step_4_edit_the_xml_for_your_virtual_machine_windows_guests_only"},"Step 4: Edit the XML for your virtual machine (Windows Guests Only)"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"From the VMs tab, click the VM icon and select Edit XML from the\ncontext menu."),(0,i.kt)("li",{parentName:"ul"},"Scroll down the XML and locate the ",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"<target>"),"{=html}")," tag for the\n",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"<disk>"),"{=html}")," with a \\'\\'\\'")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<code>"),"{=html}"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``<disk type='file' device='disk'>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<driver name='qemu' type='raw' cache='writeback'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<backingStore/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<target dev='hda' bus='virtio'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<boot order='1'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<alias name='virtio-disk0'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-{=html}"},"<address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``</disk>"),"{=html}",(0,i.kt)("inlineCode",{parentName:"p"},"</code>"),"{=html}"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Adjust vdisk1.img by changing the ",(0,i.kt)("strong",{parentName:"li"},"bus")," attribute to the\n",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"<target>"),"{=html}")," tag to ",(0,i.kt)("strong",{parentName:"li"},"ide"),"."),(0,i.kt)("li",{parentName:"ul"},"Delete the entire \\'\\'\\'",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-{=html}"},"<address>\n")),(0,i.kt)("strong",{parentName:"li"},"line for that"),(0,i.kt)("inlineCode",{parentName:"li"},"<disk>"),"{=html}\\'\\'\\'."),(0,i.kt)("li",{parentName:"ul"},"Corrected XML example below:")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<code>"),"{=html}"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``<disk type='file' device='disk'>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<driver name='qemu' type='raw' cache='writeback'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<backingStore/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<target dev='hda' bus='ide'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<boot order='1'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``</disk>"),"{=html}",(0,i.kt)("inlineCode",{parentName:"p"},"</code>"),"{=html}"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Update")," to update the virtual machine XML.")),(0,i.kt)("h2",{id:"step_5_install_the_virtio_drivers_from_inside_the_vm_windows_guests_only"},"Step 5: Install the VirtIO drivers from inside the VM (Windows Guests Only)"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Using ",(0,i.kt)("strong",{parentName:"li"},"Windows File Explorer"),", navigate to the VirtIO virtual\ncd-rom to browse its contents.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Navigate inside the ",(0,i.kt)("strong",{parentName:"li"},"Balloon")," folder."),(0,i.kt)("li",{parentName:"ul"},"Navigate to the subfolder named after your ",(0,i.kt)("strong",{parentName:"li"},"Windows OS\nversion")," (e.g. w8.1)"),(0,i.kt)("li",{parentName:"ul"},"Navigate to the ",(0,i.kt)("strong",{parentName:"li"},"amd64")," subfolder"),(0,i.kt)("li",{parentName:"ul"},"Right-click on the ",(0,i.kt)("strong",{parentName:"li"},"balloon.inf")," file inside and click Install\nfrom the context menu (you may need to enable viewing of file\nextensions to do this)"))),(0,i.kt)("li",{parentName:"ul"},"Repeat the above process for each of the following folders:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"NetKVM")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"vioserial")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"viostor")))),(0,i.kt)("li",{parentName:"ul"},"When done installing drivers, navigate inside the virtual cd-rom one\nmore time and open the ",(0,i.kt)("strong",{parentName:"li"},"guest-agent")," folder."),(0,i.kt)("li",{parentName:"ul"},"Double-click on ",(0,i.kt)("strong",{parentName:"li"},"qemu-ga-x64.msi")," to install the QEMU/KVM guest\nagent.")),(0,i.kt)("h2",{id:"step_6_remove_the_secondary_vdisk_from_your_vm_windows_guests_only"},"Step 6: Remove the secondary vdisk from your VM (Windows Guests Only)"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Shutdown")," your VM if it isn't already."),(0,i.kt)("li",{parentName:"ul"},"From the ",(0,i.kt)("strong",{parentName:"li"},"VMs")," tab, click the VM icon and select ",(0,i.kt)("strong",{parentName:"li"},"Edit")," from the\ncontext menu."),(0,i.kt)("li",{parentName:"ul"},"Remove the vdisk2.img virtual disk by clicking the red minus symbol."),(0,i.kt)("li",{parentName:"ul"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Update")," to update the VM."),(0,i.kt)("li",{parentName:"ul"},"Start your newly converted virtual machine!")),(0,i.kt)("h2",{id:"extra_help_stuck_at_seabios_with_booting_from_hard_disk"},'Extra: HELP! Stuck at SeaBIOS with \\"Booting from Hard Disk\\"'),(0,i.kt)("p",null,"If your OS was installed using UEFI (as opposed to traditional VGA\nBIOS), start over from step 3, but select OVMF as the BIOS type instead\nof SeaBIOS. Most OS installations install using a traditional VGA BIOS,\nbut it is possible to have a UEFI installation, in which case SeaBIOS\nwill not work. The remainder of the conversion procedure is identical."),(0,i.kt)("h1",{id:"using_a_physical_disk_in_a_vm_including_one_with_an_os_already_installed"},"Using a physical disk in a VM, including one with an OS already installed"),(0,i.kt)("p",null,"The steps for creating a VM using a physical disk are similar to that of\nusing a virtual disk. However, there are two use cases for which one\nwould be using a physical disk: creating a VM with a physical disk with\nno OS installed (new install) and one that already has an OS installed\n(conversion). We will only cover converting from a previous installation\nas the other should be straightforward enough. You can use a physical\ndisk with any OS but this conversion guide only covers Windows."),(0,i.kt)("h2",{id:"prerequisites_2"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A spare USB flash drive"),(0,i.kt)("li",{parentName:"ul"},"Acronis Universal Restore (or similar tool):")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"http://www.acronis.com/redirector/products/atih2016/aur?build=6569&edition=16&gaID=1987015932.2478000884&language=1&winver=10.0"},"http://www.acronis.com/redirector/products/atih2016/aur?build=6569&edition=16&gaID=1987015932.2478000884&language=1&winver=10.0")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"It is also recommended you back up an image of your drive just in\ncase. I recommend just using dd in the command line. It\\'s very easy\nto use, just Google it.")),(0,i.kt)("h2",{id:"step_1_preparing_the_disk"},"Step 1: Preparing the disk"),(0,i.kt)("p",null,"Moving a hard drive with a Windows installation on it from one machine\nto another can be problematic and cause blue screens if not prepped\nprior. This is because of differences in machine hardware. This applies\nwhether or not it is a physical or a virtual machine. As such we need to\nmake changes to the Windows HAL, or hardware abstraction layer. There\nare a few tools that can accomplish with, including one built into\nWindows itself called \\'sysprep\\'. However, sysprep is meant more for\ncloning a disk image across multiple machines and will activate the\nWindows OOBE (out-of-box experience) upon restoration, requiring things\nlike user account setup and other changes that are undesirable and\nunnecessary for our situation. As such we will be using a third-party\ntool by Acronis (Universal Restore). This software has a 30-Day free\ntrial, although there are likely other freeware versions that accomplish\nthe same thing if you have an issue with that."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Download and install the following:\n",(0,i.kt)("a",{parentName:"li",href:"http://www.acronis.com/redirector/products/atih2016/aur?build=6569&edition=16&gaID=1987015932.2478000884&language=1&winver=10.0"},"http://www.acronis.com/redirector/products/atih2016/aur?build=6569&edition=16&gaID=1987015932.2478000884&language=1&winver=10.0")),(0,i.kt)("li",{parentName:"ul"},"Insert your USB drive, open the program, and follow the onscreen\ninstruction to create a bootable flash drive",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Select \\'Windows-like representation\\'"),(0,i.kt)("li",{parentName:"ul"},"No Linux kernel parameters"),(0,i.kt)("li",{parentName:"ul"},"Check 32-bit or 64-bit, depending on your hardware (or both just\nto be sure)"),(0,i.kt)("li",{parentName:"ul"},"Select your USB device"))),(0,i.kt)("li",{parentName:"ul"},"Once your bootable media has been created reboot your machine and\nboot into the USB drive"),(0,i.kt)("li",{parentName:"ul"},"Just follow the onscreen instructions to apply a universal restore\nto your existing Windows installation on the drive. It should only\ntake a second or two."),(0,i.kt)("li",{parentName:"ul"},"Shutdown once that is done and boot back into Unraid")),(0,i.kt)("h2",{id:"step_2_identify_the_physical_disk_to_be_used_in_the_unraid_webgui"},"Step 2: Identify the physical disk to be used in the unRAID webGui"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Login to your webGui for unRAID 6 using a browser (http://tower or\n",(0,i.kt)("a",{parentName:"li",href:"http://tower.local"},"http://tower.local")," from a Mac OS X device by default)"),(0,i.kt)("li",{parentName:"ul"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Main")," tab."),(0,i.kt)("li",{parentName:"ul"},"If the array hasn't been started yet, start it by clicking\n",(0,i.kt)("strong",{parentName:"li"},"Start"),"."),(0,i.kt)("li",{parentName:"ul"},"Locate your disk device from the ",(0,i.kt)("strong",{parentName:"li"},"Unassigned Devices")," section on\nthe Main tab."),(0,i.kt)("li",{parentName:"ul"},"Under the identification column, notate the disk id by ",(0,i.kt)("strong",{parentName:"li"},"letter\nhandle")," (e.g. sdb, sdc, sdd, sde, ...)")),(0,i.kt)("h2",{id:"step_3_add_a_new_virtual_machine_from_the_vms_tab"},"Step 3: Add a new Virtual Machine from the VMs tab"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Login to your webGui for Unraid 6 using a browser (http://tower or\n",(0,i.kt)("a",{parentName:"li",href:"http://tower.local"},"http://tower.local")," from a Mac OS X device by default)"),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"VMs")," tab (if the tab isn't visible, you haven't\n",(0,i.kt)("a",{parentName:"li",href:"http://lime-technology.com/wiki/index.php/UnRAID_Manual_6#System_Preparation"},"completed these preparation\nsteps"),"\nor may not meet the hardware requirements; post in ",(0,i.kt)("a",{parentName:"li",href:"http://lime-technology.com/forum/index.php?board=71.0"},"general\nsupport")," for\nfurther assistance)"),(0,i.kt)("li",{parentName:"ul"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Add VM")," button."),(0,i.kt)("li",{parentName:"ul"},"Follow ",(0,i.kt)("a",{parentName:"li",href:"Manual/VM_Management#Creating_Your_Own_Virtual_Machines",title:"wikilink"},"this\nguide"),"\nto create your VM, making sure to adhere to these specific settings:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Leave the ",(0,i.kt)("strong",{parentName:"li"},"BIOS")," setting to SeaBIOS. (If you have trouble\nstarting your VM using SeaBIOS recreate it using OVMF)"),(0,i.kt)("li",{parentName:"ul"},"Leave ",(0,i.kt)("strong",{parentName:"li"},"OS Install ISO")," blank."),(0,i.kt)("li",{parentName:"ul"},"Be sure to have the ",(0,i.kt)("strong",{parentName:"li"},"VirtIO Drivers ISO")," specified, you will\nneed these in a later step."),(0,i.kt)("li",{parentName:"ul"},"Select a location and size for the \\\"primary virtual disk\\\". The\nname and size don\\'t really matter as we will be changing it in\nthe next step. This step isn\\'t really necessary, but it makes\nit a little easier to edit later."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"Uncheck")," the option to ",(0,i.kt)("strong",{parentName:"li"},"Start VM after creation"))))),(0,i.kt)("h2",{id:"step_4_edit_the_xml_for_your_virtual_machine"},"Step 4: Edit the XML for your virtual machine"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"From the VMs tab, click the VM icon and select Edit XML from the\ncontext menu."),(0,i.kt)("li",{parentName:"ul"},"Scroll down the XML and locate the the primary virtual disk you\nassigned. It will look similar to this:")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<code>"),"{=html}"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``<disk type='file' device='disk'>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<driver name='qemu' type='raw' cache='writeback'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<backingStore/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<target dev='hda' bus='virtio'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<boot order='1'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<alias name='virtio-disk0'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-{=html}"},"<address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``</disk>"),"{=html}",(0,i.kt)("inlineCode",{parentName:"p"},"</code>"),"{=html}"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'Replace it with this, where \\"sdX\\" is the location of the disk from\nstep 2:')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<code>"),"{=html}"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``<disk type='block' device='disk'>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<driver name='qemu' type='raw' cache='writeback'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0\xa0\xa0``<target dev='hdd' bus='sata'/>"),"{=html}\\\n",(0,i.kt)("inlineCode",{parentName:"p"},"\xa0\xa0\xa0``</disk>"),"{=html}",(0,i.kt)("inlineCode",{parentName:"p"},"</code>"),"{=html}"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'If your physical disk is IDE and not SATA, replace the bus from\n\\"sata\\" to \\"ide\\" and re-evaluate your life choices.'),(0,i.kt)("li",{parentName:"ul"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Update")," to update the virtual machine XML.")),(0,i.kt)("h2",{id:"step_5_installing_drivers"},"Step 5: Installing drivers"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Start your VM"),(0,i.kt)("li",{parentName:"ul"},"Once in Windows go to the device manager in the control panel"),(0,i.kt)("li",{parentName:"ul"},"If there are any drivers that have errors (a yellow exclamation\nmark) update them by right-clicking and selecting \\'update\\'",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Point to the drive where the VirtIO Drivers ISO is located and\nmake sure you check the \\'include subfolders\\' box."),(0,i.kt)("li",{parentName:"ul"},"Do this for any drivers that have errors"),(0,i.kt)("li",{parentName:"ul"},"If you have a program that installs software drivers, such as\nsome anti-virus programs do, you may need to reinstall those\nprograms")))),(0,i.kt)("h2",{id:"extra_help_stuck_at_seabios_with_booting_from_hard_disk_1"},'Extra: HELP! Stuck at SeaBIOS with \\"Booting from Hard Disk\\"'),(0,i.kt)("p",null,"If your OS was installed using UEFI (as opposed to traditional VGA\nBIOS), start over from step 3, but select OVMF as the BIOS type instead\nof SeaBIOS. Most OS installations install using a traditional VGA BIOS,\nbut it is possible to have a UEFI installation, in which case SeaBIOS\nwill not work. The remainder of the conversion procedure is identical."),(0,i.kt)("h1",{id:"converting_from_xen_to_kvm"},"Converting from Xen to KVM"),(0,i.kt)("p",null,"Virtual machines that were running in Xen to KVM will require different\nprocedures depending on whether they were created as paravirtualized or\nhardware-virtualized guests. Regardless of your conversion scenario, it\nis ",(0,i.kt)("strong",{parentName:"p"},"highly-recommended")," that you create a copy of your existing Xen\nvirtual disk before proceeding. Use the copy to test your conversion\nprocess and if successful, you can remove your own Xen-based virtual\ndisk should you so desire. In addition, you should ensure your hardware\nhas support for hardware-assisted virtualization (Intel VT-x / AMD-V) as\nthis is a requirement for use with KVM. Xen PV guests do not leverage\nhardware-virtualization extensions, which makes their process for\nconverting slightly more involved than Xen HVM guests to KVM (it is not\ndocumented at the time of this writing)."),(0,i.kt)("h2",{id:"windows_conversion_procedure"},"Windows Conversion Procedure"),(0,i.kt)("p",null,"To convert a Windows virtual machine from Xen to KVM, the process is\nfairly simple and takes about 10 minutes to perform. Remove any PCI\ndevice pass through that you are doing via your Xen domain cfg file\nbefore you begin. These devices can be re-added after the conversion\nprocess is complete."),(0,i.kt)("h3",{id:"step_1_determine_if_your_vm_is_using_xens_gplpv_drivers"},"Step 1: Determine if your VM is using Xen\\'s GPLPV drivers"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"From within your Xen VM, open ",(0,i.kt)("strong",{parentName:"li"},"Windows Device Manager")," (click\n",(0,i.kt)("strong",{parentName:"li"},"Start")," -",">"," right-click on ",(0,i.kt)("strong",{parentName:"li"},"Computer")," -",">"," click ",(0,i.kt)("strong",{parentName:"li"},"Manage"),")"),(0,i.kt)("li",{parentName:"ol"},"Expand the node for ",(0,i.kt)("strong",{parentName:"li"},"Network adapters"),' and note the name. If the\nname of the network device contains \\"Xen\\", then you are using\nGPLPV drivers. Anything else means you are not.')),(0,i.kt)("p",null,"NOTE: IF YOU ARE NOT USING GPLPV DRIVERS, YOU CAN SKIP THE NEXT SEVERAL\nSTEPS AND RESUME THE PROCEDURE FROM REBOOTING INTO KVM MODE."),(0,i.kt)("h3",{id:"step_2_prepare_windows_for_gplpv_driver_removal"},"Step 2: Prepare Windows for GPLPV driver removal"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Open a command prompt, running it as administrator (click ",(0,i.kt)("strong",{parentName:"li"},"Start"),"\n-",">"," click ",(0,i.kt)("strong",{parentName:"li"},"All Programs")," -",">"," click ",(0,i.kt)("strong",{parentName:"li"},"Accessories")," -",">"," right-click\n",(0,i.kt)("strong",{parentName:"li"},"Command Prompt")," -",">"," click ",(0,i.kt)("strong",{parentName:"li"},"Run as administrator"),")"),(0,i.kt)("li",{parentName:"ol"},"Type the following command from the prompt:\n",(0,i.kt)("inlineCode",{parentName:"li"},"bcdedit -set loadoptions nogplpv")),(0,i.kt)("li",{parentName:"ol"},"Reboot your VM")),(0,i.kt)("h3",{id:"step_3_download_the_uninstaller_and_remove_the_gplpv_drivers"},"Step 3: Download the uninstaller and remove the GPLPV drivers"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Once rebooted, open a browser and download the following zip file:\n",(0,i.kt)("a",{parentName:"li",href:"https://drive.google.com/file/d/0BwGv31twDcCeNElTTWFLbXEycWs/view?usp=sharing"},"gplpv_uninstall_bat.zip")),(0,i.kt)("li",{parentName:"ol"},"Extract the ",(0,i.kt)("inlineCode",{parentName:"li"},"uninstall_0.10.x.bat")," file to your desktop"),(0,i.kt)("li",{parentName:"ol"},"Right click on the file and click ",(0,i.kt)("strong",{parentName:"li"},"Run as administrator")," (this\nwill happen very quick)"),(0,i.kt)("li",{parentName:"ol"},"Reboot your VM"),(0,i.kt)("li",{parentName:"ol"},"After rebooting, open up ",(0,i.kt)("strong",{parentName:"li"},"Windows Device Manager")," again."),(0,i.kt)("li",{parentName:"ol"},"Under the System Devices section, right-click on ",(0,i.kt)("strong",{parentName:"li"},"Xen PCI Device\nDriver")," and select ",(0,i.kt)("strong",{parentName:"li"},"Uninstall"),", and the confirmation dialog,\nclick the checkbox to ",(0,i.kt)("strong",{parentName:"li"},"Delete the device driver software for this\ndevice"),"."),(0,i.kt)("li",{parentName:"ol"},"Shut down the VM")),(0,i.kt)("h3",{id:"step_4_create_a_new_vm_with_the_vm_manager"},"Step 4: Create a new VM with the VM Manager"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If you haven\\'t already, follow the procedure documented ",(0,i.kt)("strong",{parentName:"li"},"here")," to\nenable VM Manager"),(0,i.kt)("li",{parentName:"ol"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"VMs")," tab and click ",(0,i.kt)("strong",{parentName:"li"},"Add VM")),(0,i.kt)("li",{parentName:"ol"},"Give the VM a name and if you haven\\'t already, download the VirtIO\ndrivers ISO and specify it"),(0,i.kt)("li",{parentName:"ol"},"Under ",(0,i.kt)("strong",{parentName:"li"},"Operating System")," be sure ",(0,i.kt)("strong",{parentName:"li"},"Windows")," is selected"),(0,i.kt)("li",{parentName:"ol"},"Under ",(0,i.kt)("strong",{parentName:"li"},"Primary vDisk Location"),", browse and select your Xen virtual\ndisk"),(0,i.kt)("li",{parentName:"ol"},"Add a ",(0,i.kt)("strong",{parentName:"li"},"2nd vdisk")," and give it a size of ",(0,i.kt)("strong",{parentName:"li"},"1M")," (you can put this\nvdisk anywhere, it is only temporary)"),(0,i.kt)("li",{parentName:"ol"},"Leave graphics, sound, etc. all to defaults and click ",(0,i.kt)("strong",{parentName:"li"},"Create")),(0,i.kt)("li",{parentName:"ol"},"Upon creation, immediately force shutdown the VM (click the eject\nsymbol from the VMs page)"),(0,i.kt)("li",{parentName:"ol"},"Click the \\</",">"," symbol from the VMs page next to the VM to edit the\nXML"),(0,i.kt)("li",{parentName:"ol"},"Locate the ",(0,i.kt)("inlineCode",{parentName:"li"},"<disk>"),"{=html} section for your primary virtual disk."),(0,i.kt)("li",{parentName:"ol"},"Remove the ",(0,i.kt)("inlineCode",{parentName:"li"},"<code>"),"{=html}",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-{=html}"},"<address>\n")),(0,i.kt)("inlineCode",{parentName:"li"},"</code>"),"{=html} line completely."),(0,i.kt)("li",{parentName:"ol"},"Change the ",(0,i.kt)("inlineCode",{parentName:"li"},"bus='virtio'")," from the ",(0,i.kt)("inlineCode",{parentName:"li"},"<target>"),"{=html} section to\n",(0,i.kt)("inlineCode",{parentName:"li"},"bus='ide'")),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Update"))),(0,i.kt)("h3",{id:"step_5_starting_your_new_vm_and_loading_the_virtio_drivers"},"Step 5: Starting your new VM and loading the VirtIO drivers"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"From the VMs page, click the ",(0,i.kt)("strong",{parentName:"li"},"VM icon"),", then click ",(0,i.kt)("strong",{parentName:"li"},"Start"),"."),(0,i.kt)("li",{parentName:"ol"},"Once the VM is started, click the icon again, then click ",(0,i.kt)("strong",{parentName:"li"},"VNC\nRemote"),"."),(0,i.kt)("li",{parentName:"ol"},"When the VM boots up, it will install several drivers and prompt a\nreboot, select ",(0,i.kt)("strong",{parentName:"li"},"Reboot later")),(0,i.kt)("li",{parentName:"ol"},"Open ",(0,i.kt)("strong",{parentName:"li"},"Windows Device Manager")," again and you\\'ll notice 3 warnings\nunder ",(0,i.kt)("strong",{parentName:"li"},"Other devices")," (Ethernet Controller, PCI Device, SCSI\nController, Serial controller)"),(0,i.kt)("li",{parentName:"ol"},"For each device, double click the device, click ",(0,i.kt)("strong",{parentName:"li"},"Update Driver"),",\nthen select ",(0,i.kt)("strong",{parentName:"li"},"Browse my computer for driver software"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Specify a path of the virtio drivers ISO (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"d:\\"),") for the\npath for each device, and the appropriate drivers will be\nautomatically loaded."),(0,i.kt)("li",{parentName:"ol"},"Select to ",(0,i.kt)("strong",{parentName:"li"},"Always trust Red Hat")," if prompted."))),(0,i.kt)("li",{parentName:"ol"},"Open Windows File Explorer and browse to the ",(0,i.kt)("strong",{parentName:"li"},"guest-agent")," folder\non the virtio driver disk and double click the ",(0,i.kt)("inlineCode",{parentName:"li"},"qemu-ga-x64.msi"),"\nfile to install the QEMU guest agent."),(0,i.kt)("li",{parentName:"ol"},"Shut down your VM.")),(0,i.kt)("h3",{id:"step_6_remove_the_temporary_vdisk_and_start_the_vm"},"Step 6: Remove the temporary vdisk and start the VM"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click to edit the VM using the form-based editor (the pencil symbol)"),(0,i.kt)("li",{parentName:"ol"},"Remove the secondary vdisk"),(0,i.kt)("li",{parentName:"ol"},"Ensure the primary vdisk is pointing to your original vdisk file (it\nmay be pointing to the secondary vdisk, and if so, update it to\npoint to your actual vdisk)"),(0,i.kt)("li",{parentName:"ol"},"When completed, click ",(0,i.kt)("strong",{parentName:"li"},"Update")),(0,i.kt)("li",{parentName:"ol"},"Start your VM"),(0,i.kt)("li",{parentName:"ol"},"Verify your device manager shows no warnings"),(0,i.kt)("li",{parentName:"ol"},"DONE!")))}m.isMDXComponent=!0},8372:(e,t,a)=>{a.d(t,{Z:()=>n});const n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAoCAYAAAHhxWh1AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFWAAABcRAZ3HPHIAAAiOSURBVEhLnVcJW1vXEdU/bmJTJ02aJnHaJnHqNEmbGNvgYIMN2I5xvITYIFaBhNmEQYDFvohdIEAb2qbnzHtXek9I+kiHb5B039y5c2c5M8+Tz+elnHSx3ntJbvdckVs9f7YWpSDS2PcXOcumpGP0e/2ui3f6PsJiUtr9X+t3T6FQkBvd70tD7weO7WXkSZ3F9Sm52XdVPPXey/IEimc3/XLTW2cttEHp9IYPUljg0WbLvcHPLENJ2XxGHga+UYNv916Rvrl2XSepULv/q+LOdCYhY8uvir+nNwagOpPCoZfFF+6w95XoTv/HcAfOV02BkqZUJi6jS78Xf0+t95Uums9n1aaG3g/VLS6b7M+aVBSajQT0Vrzdz/1/lVhiz35iC3VN38X5dWoDBfnJ+K0fzFlCJ8mDopGPRq7rovl9ExtJHm/ovi48fvOtdM+06CLj0ez7Qtf3TzbE8/jNdf1RYOQddJzcV03vtkfF0xN6oEJt8HrnVKMKMJDNvs+xXgdNm7ApFVUh8qORf6mQ+c3wk+zbNesuPmjo+1A/9XbR+ZIQaW5rRP3DvONRJ8mo/QRClRKdlMmmZSe2iiwYlKm1PlnaDcpp+sh+ep5ciuLpY+mZbbVtvqyfbq6T+u5L6oiVvWlhZRhSRYVCXnPRRM1w8+DnMr3pk/DOuLycvOV6Rv7lzb8leXZqKWIo5iIjLgFaQ3448g3SNKGCTFXWlD6zHcrvj5ERmdyZeLLZjPw6/p/iVbqm78lJ6lASuGYS5WqCnsml7bUTWdmfARQwKpbCZVzTk81l5OlYSdGrt01ycBqRaHxbYshFXpuUypzq2lF8VxZ3JrVWjCL6C1AiSKkxXShxnZrPpHFezbqStZnMq/4y+p1aq87O49SJlW4428Ilw/d8n0loc0hD/2LypusZlXaM/VA8yFW5RJK+2XY7eqWTnUwrWof/KWt2LRpyKXJSOpOUraNFmQHqBdd6ZWFnAkGInqs4Q1UV/VGqqug0FZPF3Um1hmWye7yqTq1G5xQdJXalJ9SqxWmAzILqDxRt5lG4OcBlORUVMV8WkB/3h/6unaWSs+loKuyfe6SJ6aSiIiYVO4dJTMOl+jOKkWOQ6Z1tkyxKw5AqigMe2v3XIFCygt87gw3qp5mNIVz14+Izw8w9Q6poZPGlIplTiNcYX+lSIZYRc8cUq+H2wNeaEiRPMnMiD4b+4ahoy/QbwJ2xldcqlIMi+o6HOa/eiHoLo7xInshRGK3uI0sJlHFDx+gPwJrvAC8BFcrlsvL71B15gjViUAOGAKNsKPxUAc7DHkDNdCL9EDlcVLAiZDjzxqwRYrpnCPLWwUSLfD4nnlBkSEPKxXuDn0qiLKzlxNP9C88tRXDD88l65FXGsshgC7v52sGsYk70dFuSaOKGYol9xaODk4iCn8uiAixiYVKBuXMLeiPnntbhL2UGEEJi438+Ua+g3+b/Euho+ZQ8bHyUysZ1k4maxegWGv5S1B4MI7IasZIcJy82BlLNPDLhZwarItdhyCNYbpqkKkqkYzofuDIbm34L3tbSISY5r2+sCmLwMVSstfX9OblbodbYLazRsHQIre2fe+hKj6IiOoyn09kUdCozbF3tigzMP1ZYdlJRkaFYcg949ECHBEaH1jA9mvo/Qcf4VocY06KcdE4RiYKcfhaB00RI+mjraEnn5GpUdRqpRgR/uiGHJOSwy6nFyVzLF7JqTLVGUYsuZBAhmti3fbQs77ZGZWLVK4PvnqA6fsbY8KOCxVP0Sn5/Pd0kPjybhAxzdTu2LHH0Edb1RaimQRy7OHdwWH869l8kxlWNH5ODdWBgzsnOdRYQ0e3Z+E8SWHyhczJfR2pRRYO4aQG3Y300DXziaCOVmBnq5EoyFrNFdU41IOtncIY7mw25DOJos3kYlgE0v7sDf4MSNoHKhzDbKfMwcA3d97oWPJGg1gWoix27BRXjX3im7wI55JuTigYx89f2Q2gUjRoW1mY59BhmyPhqMBz+VZE3lU1oXziK74lv/on9ymDqu3w/8fKS9hg2JeaYq1mzYgjbbEAvgMgUrAYghvn8EbwyjmadxlutISY/J3X2Y8pVuxCZOuhhL96itmJLtgYYxH/ReESTrgkCTMbyzaZ/W0nLPv6+TvFjy6+LUyiJ3YFjr9XXrQQ3+8pDT2MZPjZRTiHsuCQN2fLelLwM3lJcLjeILcoLpORBwdVemVzxKvN1gzBA3DGUQ2lvHS5JCOOPkQuu9mgXeo1mSl3OxDdGEYmZu9pgzzJpvO/6AcMYLtj6eRt7E11KTEmcHdtH/v/EkZTN2HQznmF5vg7OuI2paEJDrgaFIsPWtFNmUNOgMaj2XHIR4ujBIrjTV2YQPgkvfA1QgwoI2cr+W10kkDlDRne2MWRIPCrjYBBYeCH+8HO83PbDzQuaN4ZQHur6SYSJcgEMTyPITXqGqN6K8eVcyAARGrJoWNuNJvUhSvfNUif6/acug3QTbsHkZCIb/rHrT5hir8koKirlGMBoHPUQ0Sn3U/d7xT1WgjuMwXcLk65qmzk1Sc2y582IB3x55msHNzuNKudqZc9+xcq7UNlj4iaIekP3MQEs2xqcwJhLodfMKzCaubZaK7jZA2AMfKVoy6ZLYujZRDlp1wZGXsgy5hUa8e7xmqtSXa2DvtqJrWi+sO9wiqqmlLGnNzna8vWbzHzTtx3veXmyhgn7GKbh8DPZQ+soH640ZOWUTJ9gzBhTaOdtjccqGaeVwspUrvIc+6ijBYDJgZ4ThDP3nFRx0jPEt8uN6LwmKoGzZegLPcSZsHS/hcr26IHcuKHP3lNvcBxnBY8vd2lVVjPEUE2DDBGBiUV7x+uytDslb9f7FZ86cRDxi12ezO+dwUY868C4OqjD9f7JJow4VRS+CF3IoMqEUGuFlv1pCvzx0dUikf8B71oO9fK129oAAAAASUVORK5CYII="},6075:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Bios-virtualization1-8c032a63c7faa4306a38ab048f689477.png"},9745:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Bios-virtualization2-3bd48a4a433dc6241b2716f10a877461.jpg"},9999:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Bios-virtualization3-f24cc6d14dd9aff84916592c300a0e98.JPG"},9898:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/Bios-virtualization4-72a6a8a03a546e90dc8e007574b430c2.png"}}]);